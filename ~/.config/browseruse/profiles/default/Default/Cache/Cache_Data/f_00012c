/*
 Kingdee Galaxy 
 build on [2023-05-30 09:33:03.729]. 
**/
!function(e){window.KDVGridUtils=function(){},e.extend(KDVGridUtils,{fieldInvalidChars:{},getLocaleText:function(){return{}},getIcons:function(){return{}},loadKDVGridResource:function(e){var t=window.KDVXReses||{};t.lastLCID!=(e||2052)&&(t.lastLCID=e||2052,KD.extendObject(t.images,{queryDataTipsSrcSize:{width:36,height:36},queryDataTipsSrc:"data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIHN0eWxlPSJ2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7ZmlsbDpjdXJyZW50Q29sb3I7b3ZlcmZsb3c6aGlkZGVuOyIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik02NzkuNjUxMjgxIDcyMy44NDU0NTZDNjE0LjMxNzQ1OSA3NzkuMTUxMzQ3IDUyOS44MDMyMjggODEyLjUgNDM3LjUgODEyLjVDMjMwLjM5MzIxOSA4MTIuNSA2Mi41IDY0NC42MDY3ODEgNjIuNSA0MzcuNUM2Mi41IDIzMC4zOTMyMTkgMjMwLjM5MzIxOSA2Mi41IDQzNy41IDYyLjVDNjQ0LjYwNjc4MSA2Mi41IDgxMi41IDIzMC4zOTMyMTkgODEyLjUgNDM3LjVDODEyLjUgNTI5LjgwMzIyOCA3NzkuMTUxMzQ3IDYxNC4zMTc0NTkgNzIzLjg0NTQ1NiA2NzkuNjUxMjgxTDkyOC4zNDcwOTQgODg0LjE1MjkwNkM5NDAuNTUwOTc4IDg5Ni4zNTY3OTEgOTQwLjU1MDk3OCA5MTYuMTQzMjA5IDkyOC4zNDcwOTQgOTI4LjM0NzA5NEM5MTYuMTQzMjA5IDk0MC41NTA5NzggODk2LjM1Njc5MSA5NDAuNTUwOTc4IDg4NC4xNTI5MDYgOTI4LjM0NzA5NEw2NzkuNjUxMjgxIDcyMy44NDU0NTZMNjc5LjY1MTI4MSA3MjMuODQ1NDU2ek00MzcuNSA3NTBDNjEwLjA4ODk4NCA3NTAgNzUwIDYxMC4wODg5ODQgNzUwIDQzNy41Qzc1MCAyNjQuOTExMDE2IDYxMC4wODg5ODQgMTI1IDQzNy41IDEyNUMyNjQuOTExMDE2IDEyNSAxMjUgMjY0LjkxMTAxNiAxMjUgNDM3LjVDMTI1IDYxMC4wODg5ODQgMjY0LjkxMTAxNiA3NTAgNDM3LjUgNzUweiIgc3R5bGU9ImZpbGw6IHJnYig0NCwgNDQsIDQ0KTsiPjwvcGF0aD48L3N2Zz4NCg==",emptyDataTipsSrcSize:{width:208,height:127},emptyDataTipsSrc:"../images/biz/default/MainConsole/H5CardLayout/icon_task_NoData.png",inputDelBtnSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaBAMAAABbZFH9AAAALVBMVEUAAABmmcxahO9Wg/JWgvNWgvJXg/FWgvJWgvJVgvJxlfRyl/SMqveLqvb1+P8ZbyMkAAAAD3RSTlMABR9laIWWq7KzvLzFxvg0lMVQAAAAdElEQVQY02NgoBVgMitPVoBxGD1mzpzZIgDlic4EgUAozxPMmwLV1Tlz5czZM2dAdDLPnP1m5r2VMw3APLaZM8+deTtzZgKYxz5z5tx3N2fOLIDx5rw7CeOBVN55A1PJPHPWW4QpqDag2o7mMlRXo/qIDAAAa4E+CaTxLEQAAAAASUVORK5CYII="}),KD.extendObject(t.KDVGridColFilter,{btnReset:ResManager.LoadKDString("重置","0141072030045446"),btnClear:ResManager.LoadKDString("清除","0991733000003921"),btnOK:ResManager.LoadKDString("确定","0991733000003896")}),KD.extendObject(t.KDVListView,{defaultAllItem:ResManager.LoadKDString("全部","0025710030033446"),defaultNullItem:ResManager.LoadKDString("(空)","0141072000004084"),multiSelTips:ResManager.LoadKDString("已选 {0} 项","0141072030045448"),searching:ResManager.LoadKDString("过滤搜索","0141072030045449")}),KD.extendObject(t.KDVFindWindow,{inpTxtHolder:ResManager.LoadKDString("定位下一个匹配单元格","0141072030045450"),btnClose:ResManager.LoadKDString("关闭","0141072030045451"),btnSearch:ResManager.LoadKDString("查找","0991733030033251"),msgNoFound:ResManager.LoadKDString("未查到匹配数据！","0141072030045452"),emptyValue:ResManager.LoadKDString("查找文本为空","0141072030045453"),title:ResManager.LoadKDString("查找","0991733030033251")}),KD.extendObject(t.KDVGrid,{colAggr:ResManager.LoadKDString("列集合","00214298000005659"),frozenLeft:ResManager.LoadKDString("左冻结","0141072030045454"),frozenRight:ResManager.LoadKDString("右冻结","0141072030045455"),unfrozen:ResManager.LoadKDString("解除冻结","0141072030045456"),groupby:ResManager.LoadKDString("分组","0141072030045457"),ungroupby:ResManager.LoadKDString("解除分组","0141072030045458"),copy:ResManager.LoadKDString("拷贝","0025710030034373"),parse:ResManager.LoadKDString("粘贴","0025710030034378"),cellMultiSel:ResManager.LoadKDString("块选择","0141072030045572"),unCellMultiSel:ResManager.LoadKDString("取消块选择","0141072030045573"),filterRowCellHolder:ResManager.LoadKDString("过滤条件","0991733000003935"),queryData:ResManager.LoadKDString("正在查询数据~","0141072030045760"),emptyData:ResManager.LoadKDString("很抱歉，暂时没有相关数据~","0141072000005298"),locateCellTipsTemplate:ResManager.LoadKDString(" (列:{0}, 行:{1}) ","0141072000004097")}),KD.extendObject(t.AggrFuncNames,{sum:ResManager.LoadKDString("汇总","0141072030045461"),min:ResManager.LoadKDString("最小","0141072030045462"),max:ResManager.LoadKDString("最大","0141072030045463"),avg:ResManager.LoadKDString("平均","0141072030045464"),count:ResManager.LoadKDString("计数","0141072030045465"),first:ResManager.LoadKDString("首个","0141072000004103"),last:ResManager.LoadKDString("最后","0141072030045467")}))},regularFieldName:function(e){var t=(e||"").toUpperCase();return t=KDVGridUtils.fieldInvalidChars.a2b(t)},reverFieldName:function(e){var t=e?e:"";return t=KDVGridUtils.fieldInvalidChars.b2a(t)},hasColEditor:function(e){var t=!1,i=(e||{}).columns||[];try{for(var r=0;r<i.length;r++)if(i[r].editor){t=!0;break}}catch(o){t=!1}return t},testNT:function(){var e=function(){return function(){console.log("testNT.")}}();return setTimeout.call(window,e)}})}(jQuery),function(e){var t=KDVGridUtils.fieldInvalidChars;e.extend(t,{__a2bCache:{},__b2aCache:{},aPartten:/[\.\&\%\[\]]/g,bPartten:/(__[1-9,A-Z]_)/g,maps:[[".","__D_"],["&","__A_"],["%","__1_"],["[","__2_"],["]","__3_"],["(","__4_"],[")","__5_"]],retset:function(){t.__a2bCache={},t.__b2aCache={}},a2b:function(e){var i=e||"",r=i,o=t.__a2bCache,n=o[i];if(void 0!==n)return i=n;var a=t.aPartten,l=t.maps;if(a.lastIndex=0,a.test(i))for(var s=0;s<l.length;s++){var d=l[s];i=i.replace(new RegExp("\\"+d[0],"g"),d[1])}return o[r]=i,i},b2a:function(e){var i=e||"",r=i,o=t.__b2aCache,n=o[i];if(void 0!==n)return i=n;var a=t.aPartten;if(a.lastIndex=0,a.test(i))return o[r]=i,i;var l=t.bPartten,s=t.maps;if(l.lastIndex=0,l.test(i))for(var d=0;d<s.length;d++){var c=s[d];i=i.replace(new RegExp(c[1],"g"),c[0])}return o[r]=i,i}})}(jQuery),function(e){var t=window.KDVGridProxy=window.KDVGridProxy||e.extend(KDControlProxy,{});t.colVisibleHandler=function(e,t,i,r,o,n){},t.cellValueHandler=function(e,t,i,r,o,n){var a=(t.store,i.getFieldName());if(r){var l=r&&r.rowId;i.setSvrValue.call(i,l,o[e]),t.addCellChange.call(t,i,r),n&&!t.isInit&&n.call(t,{key:e,colKey:a,rowData:r,updateView:!0})}},t.colWidthHandler=function(e,t,i,r,o,n){var a=t.store,l=i.getFieldName();i.setWidth(o[e]);t.setToRefreshGridView.call(t,{columns:{field:l,width:i.width}});n&&(a&&a.setUpdateView.call(a,!0),n.call(t,{key:e,colKey:l,rowData:r,updateView:!0}))},t.fireUpdateHandler=function(e,t,i,r,o,n){t.store;i.setFireUpdate.call(i,o[e])},t.mustInputHandler=function(t,i,r,o,n,a){var l=i.store,s=n[t];if("boolean"==typeof s)r.setMustInput.call(r,s);else for(var d in s)if(e.isRunInForIn(d,s))if(-1==parseInt(d))r.setMustInput.call(r,s[d]);else{var c=l.getColumnDescriptor(d);c&&c.setMustInput.call(c,s[d])}l&&l.setUpdateView.call(l,!0)},t.xColDspCtrlTypeHandler=function(e,t,i,r,o,n){var a=(t.store,i.getFieldName());i.setXColDspCtrlType.call(i,o[e]),t.addCellChange.call(t,i,r),n&&!t.isInit&&n.call(t,{key:e,colKey:a,rowData:r,updateView:!0})},t.isRedBlueHandler=function(e,t,i,r,o,n){var a=t.store,l=i.getFieldName();a.isRedBlue=o[e],i.setIsRedBlue.call(i,o[e]),n&&!t.isInit&&n.call(t,{key:e,colKey:l,rowData:r,updateView:!0})},t.allowAutoListHandler=function(e,t,i,r,o,n){t.store;i.setAllowAutoList.call(i,o[e])},t.isLocatedFirstRowHandler=function(e,t,i,r,o,n){t.store;i.setIsLocatedFirstRow&&i.setIsLocatedFirstRow.call(i,o[e])},t.showEditButtonHandler=function(e,t,i,r,o,n){t.store;i.setShowEditButton.call(i,o[e])},t.colHeaderHandler=function(e,t,i,r,o,n){var a=t.store,l=i.getFieldName();i.setCaption.call(i,o[e]);t.setToRefreshGridView.call(t,{columns:{field:l,title:i.header}});n&&(a&&a.setUpdateView.call(a,!0),n.call(t,{key:e,colKey:l,rowData:r,updateView:!0}))},t.colHeaderAlignmentHandler=function(e,t,i,r,o,n){var a=t.store,l=i.getFieldName.call(i);i.setHeaderAlignment.call(i,o[e]);t.setToRefreshGridView.call(t,{columns:{field:l,headerAttributes:i.getHeaderAttributes.call(i)}});n&&(a&&a.setUpdateView.call(a,!1),n.call(t,{key:e,colKey:l,rowData:r,updateView:!1}))},t.storeHandler=function(e,t,i,r,o,n){var a=(t.store,i.getFieldName());i.setStore(o[e]),n&&!t.isInit&&n.call(t,{key:e,colKey:a,rowData:r,updateView:!0})},t.menuStateHandler=function(e,t,i,r,o,n){var a=(t.store,i.getFieldName());i.setStore(o[e]);var l=o[e];n&&!t.isInit&&n.call(t,{key:e,colKey:a,rowData:r,data:l,updateView:!1})},t.focusedStateHandler=function(e,t,i,r,o,n){var a=(t.store,i.getFieldName()),l=o[e];l=o.FocusRowIndex,l=o.MoveFirstRowIndex,l=o.MovePreviousRowIndex,l=o.MoveNextRowIndex,l=o.MoveLastRowIndex,l=void 0===l?-1:l,n&&n.call(t,{key:e,colKey:a,rowData:r,data:l,updateView:!1})},t.colorHandler=function(i,r,o,n,a,l){var s=(i==e.KDVGridActionKeys.Backcolor?"background":"color",r.store),d=n&&n.rowId,c=o&&o.getFieldName(),u=a[i]||"transparent";if("string"==typeof u)t.updateCellProp(i,o,n,a),r.addCellChange.call(r,o,n);else for(var g in u)if(e.isRunInForIn(g,u)){var f=u[g],p=f,h=o;if(!h){var D=s.getIndexKey.call(s);h=s.getColumnDescriptor.call(s,D)}if(d=parseInt(g),h&&d>=0){c=h.getFieldName();var y=s.getRowDataByServerRowId.call(s,d);r.addCellChange.call(r,o,y)}else if(0>d){d=s.getRowId(n),r.addCellChange.call(r,null,n);continue}t.updateCellProp(i,h,y,f)}l&&!r.isInit&&l.call(r,{key:i,colKey:c,rowData:n,data:p,updateView:!0})},t.cellDisabledHandler=function(i,r,o,n,a,l){var s=r.store,d=o.getFieldName.call(o);if(!a||d==(a.key||"").toUpperCase()){var c=a[i];if(e.isObject(c)){var u=c["true"]||[],g=c["false"]||[];for(var f in u)if(e.isRunInForIn(f,u)){var p=s.getRowDataByServerRowId.call(s,u[f]),h={row:u[f],key:d};h[e.KDVGridActionKeys.Disabled]=!0,cellDisabledHandler(i,r,o,p,h,l)}for(var f in g)if(e.isRunInForIn(f,g)){var p=s.getRowDataByServerRowId.call(s,g[f]),h={row:g[f],key:d};h[e.KDVGridActionKeys.Disabled]=!1,cellDisabledHandler(i,r,o,p,h,l)}}else{if(i==e.KDVGridActionKeys.Disabled){r.disableActions=r.disableActions||[];var D={row:a.row,key:a.key};D[e.KDVGridActionKeys.Undisabled]=!c,r.disableActions.push(D)}n?t.updateCellProp(i,o,n,a):(o.setDisabled.call(o,n,c),t.updateCellProp(i,o,void 0,a)),l&&!r.isInit&&l.call(r,{key:i,colKey:d,rowData:n,updateView:!0})}}},t.cellUnDisabledHandler=function(e,i,r,o,n,a){var l=(i.store,r?r.getFieldName():void 0);if(l){var s=n[e];o?t.updateCellProp(e,r,o,n):(r.setUndisabled.call(r,o,s),t.updateCellProp(e,r,void 0,n)),a&&!i.isInit&&a.call(i,{key:e,colKey:l,rowData:o,updateView:!0})}},t.tooltipEnabledHandler=function(t,i,r,o,n,a){if(!o){var l=n[t],s=!1;e.isObject(l)?s=e.getValue(l,"-1",!1):void 0!==n[t]&&(s=n[t]),r.tooltipEnabled(s),a&&!i.isInit&&a.call(i,{key:t,colKey:colKey,rowData:o,updateView:!0})}},t.tooltipHandler=function(i,r,o,n,a,l){var s=!1,d=r.store;if(n){var c=e.getValue(a,i,{});if(!e.isEmpty(c)){s=!0;var u={};for(var g in c)if(e.isRunInForIn(g,c)){var f=parseInt(g);u[f]=f;var p=d.getRowDataByServerRowId.call(d,f);t.updateCellProp(i,o,p,a)}l&&!r.isInit&&l.call(r,{key:i,colKey:colKey,rowData:n,updateView:!0})}}else void 0!==a[i]&&(s=!0,t.updateCellProp(i,o,n,a),l&&!r.isInit&&l.call(r,{key:i,colKey:colKey,rowData:n,updateView:!0}))},t.cellHiddenHandler=function(i,r,o,n,a,l){var s=!1,d=r.store;if(n){var c=e.getValue(a,i,{});if(!e.isEmpty(c)){s=!0;var u={};for(var g in c)if(e.isRunInForIn(g,c)){var f=parseInt(g);u[f]=f;var p=d.getRowDataByServerRowId.call(d,f);t.updateCellProp(i,o,p,a)}l&&!r.isInit&&l.call(r,{key:i,colKey:colKey,rowData:n,updateView:!0})}}else void 0!==a[i]&&(s=!0,t.updateCellProp(i,o,n,a),l&&!r.isInit&&l.call(r,{key:i,colKey:colKey,rowData:n,updateView:!0}))},t.updateCellProp=function(t,i,r,o){var n=!1,a=e.isObject(o)?o[t]:void 0==o?void 0:o;if(void 0!==a){n=!0;var l="set"+t.substr(0,1).toUpperCase()+t.substr(1,t.length-1);i&&$.isFunction(i[l])?i[l].call(i,r,a):e.writeLog("KDVGridProxy.updateCellProp Error","method="+l,!0)}return n},t.propHandler=function(e,i,r,o,n,a){var l=(i.store,r.getFieldName());n[e],t.updateCellProp(e,r,o,n);a&&!i.isInit&&a.call(i,{key:e,colKey:l,rowData:o,updateView:!0})},t.cellDecimalHandler=function(e,i,r,o,n,a){var l=(i.store,r.getFieldName());n[e];ret=t.updateCellProp("decimalPrecision",r,o,n);var s=s||ret;ret=t.updateCellProp("decimalIntLength",r,o,n),s=s||ret,ret=t.updateCellProp("maxValue",r,o,n),s=s||ret,ret=t.updateCellProp("minValue",r,o,n),s=s||ret,i.addCellChange.call(i,r,o),a&&!i.isInit&&a.call(i,{key:e,colKey:l,rowData:o,updateView:!0})},t.lookupHandler=function(e,t,i,r,o,n){t.store;i.setLookup.call(i,o[e])},t.exAndUrlHandler=function(e,t,i,r,o,n){t.store;i.setExAndUrl.call(i,o[e])},t.exDownloadUrlHandler=function(e,t,i,r,o,n){t.store;i.setExDownloadUrl.call(i,o[e])},t.IsMkHandler=function(e,t,i,r,o,n){i&&i.setIsMk&&i.setIsMk.call(i,o[e])},t.MkModelHandler=function(e,t,i,r,o,n){i&&i.setMkModel&&i.setMkModel.call(i,r,o[e]),n&&n.call(t,{key:e,rowData:r})},t.MkValHandler=function(e,t,i,r,o,n){i&&i.setMkVal&&i.setMkVal.call(i,r,o[e])},t.cellSplitPatternHandler=function(e,t,i,r,o,n){i&&i.setSplitPattern&&i.setSplitPattern.call(i,o[e])},function(e){e.KDVGridActionKeys=e.KDVGridActionKeys||{},$.extend(e.KDVGridActionKeys,{BarItemStates:"barItemStates",SetFocusRowIndex:"SetFocusRowIndex",ColVisible:"visible",Disabled:"disabled",Undisabled:"undisabled",ColValue:"value",Forecolor:"forecolor",Backcolor:"backcolor",IsMk:"IsMk",MkModel:"MkModel",MkVal:"MkVal",FocusRowIndex:"FocusRowIndex",IsRedBlue:"isRedBlue",AllowAutoList:"AllowAutoList",IsLocatedFirstRow:"IsLocatedFirstRow",NumFmtInfo:"NumFmtInfo",xColDspCtrlType:"xColDspCtrlType",Mask:"mask",Lookup:"lookup",CellHidden:"CellHidden",Width:"width",DecimalPrecision:"decimalPrecision",DecimalIntLength:"decimalIntLength",MaxValue:"maxValue",MinValue:"minValue",Store:"store",Caption:"caption",Header:"header",HeaderAlignment:"headeralignment",Fontbold:"fontbold",ShowEditButton:"showEditButton",FireUpdate:"fireUpdate",MustInput:"mustInput",mustinput:"mustinput",TooltipEnabled:"tooltipenabled",Tooltip:"Tooltip",ExAndUrl:"extandurl",ExDownloadUrl:"exdownloadurl",SplitPattern:"splitPattern"})}(e),function(e){if(e.KDVGridCellStateHandler=e.KDVGridCellStateHandler||{getCellStateHandler:function(e){var t=this._handlers[e];return t},doHandler:function(t,i,r,o,n){for(var a in o){o[a];this.doIt(a,t,i,r,o,n)}if(null==i)for(var a in this._wholeRowHandlerKeys)e.isRunInForIn(a,this._wholeRowHandlerKeys)&&this.doIt(a,t,i,r,o,n)},doIt:function(t,i,r,o,n,a){var l=this._handlers[t];if(l)try{l(t,i,r,o,n,a)}catch(s){e.writeError(s);var d=r?r.dataIndex+","+r.header+(r.editor?","+r.editor.xtype:""):"";e.Error.raise({sourceClass:"KDVGridProxy_CellState",sourceMethod:"doIt("+t+")<br>target:"+d+"<br>",name:ResManager.LoadKDString("执行表格Action错误","0991733000003936"),msg:s.message+"<p>"+s.stack+"<p>"+e.obj2str(n)})}}},!e.KDVGridCellStateHandler._wholeRowHandlerKeys){var i=[];e.KDVGridCellStateHandler._wholeRowHandlerKeys=i,i.push(e.KDVGridActionKeys.Backcolor),i.push(e.KDVGridActionKeys.Forecolor),i.push(e.KDVGridActionKeys.FocusRowIndex)}if(!e.KDVGridCellStateHandler._handlers){var r={};e.KDVGridCellStateHandler._handlers=r,r[e.KDVGridActionKeys.ColValue]=t.cellValueHandler,r[e.KDVGridActionKeys.Width]=t.colWidthHandler,r[e.KDVGridActionKeys.ColVisible]=t.colVisibleHandler,r[e.KDVGridActionKeys.Store]=t.storeHandler,r[e.KDVGridActionKeys.BarItemStates]=t.menuStateHandler,r[e.KDVGridActionKeys.Caption]=t.colHeaderHandler,r[e.KDVGridActionKeys.Header]=t.colHeaderHandler,r[e.KDVGridActionKeys.HeaderAlignment]=t.colHeaderAlignmentHandler,r[e.KDVGridActionKeys.FocusRowIndex]=t.focusedStateHandler,r[e.KDVGridActionKeys.SetFocusRowIndex]=t.focusedStateHandler,r[e.KDVGridActionKeys.FireUpdate]=t.fireUpdateHandler,r[e.KDVGridActionKeys.MustInput]=t.mustInputHandler,r[e.KDVGridActionKeys.mustinput]=t.mustInputHandler,r[e.KDVGridActionKeys.xColDspCtrlType]=t.xColDspCtrlTypeHandler,r[e.KDVGridActionKeys.IsRedBlue]=t.isRedBlueHandler,r[e.KDVGridActionKeys.AllowAutoList]=t.allowAutoListHandler,r[e.KDVGridActionKeys.IsLocatedFirstRow]=t.isLocatedFirstRowHandler,r[e.KDVGridActionKeys.ShowEditButton]=t.showEditButtonHandler,r[e.KDVGridActionKeys.Forecolor]=t.colorHandler,r[e.KDVGridActionKeys.Backcolor]=t.colorHandler,r[e.KDVGridActionKeys.IsMk]=t.IsMkHandler,r[e.KDVGridActionKeys.MkModel]=t.MkModelHandler,r[e.KDVGridActionKeys.MkVal]=t.MkValHandler,r[e.KDVGridActionKeys.Disabled]=t.cellDisabledHandler,r[e.KDVGridActionKeys.Undisabled]=t.cellUnDisabledHandler,r[e.KDVGridActionKeys.DecimalPrecision]=t.cellDecimalHandler,r[e.KDVGridActionKeys.DecimalIntLength]=t.cellDecimalHandler,r[e.KDVGridActionKeys.MaxValue]=t.cellDecimalHandler,r[e.KDVGridActionKeys.MinValue]=t.cellDecimalHandler,r[e.KDVGridActionKeys.Fontbold]=t.propHandler,r[e.KDVGridActionKeys.Tooltip]=t.tooltipHandler,r[e.KDVGridActionKeys.TooltipEnabled]=t.tooltipEnabledHandler,r[e.KDVGridActionKeys.CellHidden]=t.cellHiddenHandler,r[e.KDVGridActionKeys.Mask]=t.propHandler,r[e.KDVGridActionKeys.NumFmtInfo]=t.propHandler,r[e.KDVGridActionKeys.Lookup]=t.lookupHandler,r[e.KDVGridActionKeys.ExAndUrl]=t.exAndUrlHandler,r[e.KDVGridActionKeys.ExDownloadUrl]=t.exDownloadUrlHandler,r[e.KDVGridActionKeys.SplitPattern]=t.cellSplitPatternHandler}}(e)}(KD),function(e){var t=window.KDVGridProxy;e.extend(t.prototype,{C_tbBlockPasting:"__tbBlockPasting",C_tbDisplayOnlyValueCopy:"__dpColValueCopy",C_tbColSelection:"__dpColSelection",C_tbUnColSelection:"__dpUnColSelection",doSpecCtxCmd:function(e,t){var i=this;e.id==i.C_tbBlockPasting&&i.fireBlockPasting(),e.id==i.C_tbDisplayOnlyValueCopy},showClipboard:function(t){var i=this,r=e(KD.format("<div id='clipboard'><div id='clipboardText'><textarea id='clipboardTextarea'></textarea></div><div id='clipbordRemark'><span> {0}</span></div><div id='clipboardBtnList'><button id='clipboardOK' class='k-button k-primary'>{1}</button><button id='clipboardCancel' class='k-button'>{2}</button></div></div>",ResManager.LoadKDString("*请ctrl+v复制内容到上面文本框中，然后点击确定。","0025372030032936"),ResManager.LoadKDString("确定","0025372030032937"),ResManager.LoadKDString("取消","0025372030032938")));r.appendTo(e(document.body));var o=r.kendoWindow({modal:!0,autoFocus:!0,title:ResManager.LoadKDString("请把内容复制到文本框内","0025372030032935"),pinned:!0,height:470,width:450,actions:[],close:function(e){r.parent().remove()}}).data("kendoWindow");o.center().open(),r.find("#clipboardTextarea").focus(),r.find("#clipboardOK").off("click").on("click",function(r){var n=e("#clipboardTextarea").val().trim();t.call(i,n),o.close()}),r.find("#clipboardCancel").off("click").on("click",function(e){o.close()})},setAllowBlockPaste:function(e){this.AllowBlockPaste=e},doBlockPasting:function(e){var t=this,i="",r=t.getStore(),o=t.getUIFocusedCellData();if(e){for(var n=r.getVisibleCols.call(r),a=0;a<n.length;a++){var l=n[a],s=l.getFieldName.call(l);i+=","+s}i.length>0&&(i=i.substr(1),i+="\n"),i+=e,i=i.replace(/\r\n/g,"\n").replace(/\r/g,"\n");var d=t.getFormProxy(),c=r.revertKendoFieldName.call(r,o.field);d.fireEventNoData.call(d,"EntityBlockPasting",(c||"").toUpperCase(),i,o.rowId,null)}},fireBlockPasting:function(){var t=this,i=(t.getStore(),"");t.getUIFocusedCellData();return KD.isIeBrowser()?(e(document.body).unbind("paste").bind({paste:function(r){var o=r.originalEvent,n=o?o.clipboardData:void 0,a=window.clipboardData;a||(a=n),a?(i=a.getData("Text"),t.doBlockPasting(i)):alert(ResManager.LoadKDString("当前浏览器不支持粘贴板操作！","0991733030034191")),e(document.body).unbind("paste")}}),void e(document.body).trigger("paste")):void t.showClipboard(function(e){i=e,t.doBlockPasting(i)})},getLocalConfiguration:function(){return KD.isEmpty(this.localConfiguration)&&(this.localConfiguration=KD.getLocalConfiguration()),this.localConfiguration}})}(jQuery),function(e){var t=window.KDVGridProxy;e.extend(t.prototype,{doLayout:function(){var e=this,t=e.showPager?35:0,i=2,r=2;KDVGridProxy.superclass.doLayout.call(e);var o={height:e.el.height()-t-r,width:e.el.width()-i};o.height<1&&(delete o.height,e.el.css({height:"100%"})),e.gridPanel&&e.gridPanel.css(o),clearTimeout(e.gapirender_h),e.gapirender_h=setTimeout(function(e){clearTimeout(e.gapirender_h),e.vgrid&&e.vgrid.css(o);var t=e.getVGridApi.call(e);t&&t.doLayout.call(t,o)},5,e)},getLayoutSetting:function(){try{var t=this,i=t.getStore(),r=t.getVGridApi(),o={p:t.pageSize},n=[];if(KD.isEmpty(i))return o;var a=!1;if(!a&&!t.isTreeList){for(var l=r.getViewColumns(),s=[],d=0;d<l.length;d++){var c={},u=l[d],g=u.field,f=r.getColWidth(g);!KD.IsNullOrWhiteSpace(g)&&f>0&&(e.extend(c,{field:g,width:f}),s.push(c))}0==s.length&&t.columnOrderForExit.length>0?s=t.columnOrderForExit:t.columnOrderForExit=s;var p=i.getColumnDescriptors.call(i);if(p)for(var h in p){var D=p[h],y=D&&D.getLayoutSetting&&D.getLayoutSetting.call(D,s);!KD.isEmpty(y)&&!KD.isEmpty(y.w)&&y.w>-1&&n.push(y)}n=t.getSortLayoutSetting(n),o.cols=n}return o}catch(v){return KD.writeLog(KD.format("KDVGridProxy GetLayoutSetting Error:{0}",v.message),"",!0),null}},getSortLayoutSetting:function(e){var t=this,i=t.sortLayoutSetting(e);return i},sortLayoutSetting:function(e){try{for(var t=this,i=t.getStore(),r=[],o=0;o<e.length;o++){var n=e[o],a=n&&n.i?n.i:0,l=n&&n.k?n.k:"",s=i.getColumnDescriptor.call(i,l);KD.isEmpty(s)||(9999==a&&s.visible&&(a=s.colIndex,n.i=a),r.push(n))}r.sort(function(e,t){var r=KD.isEmpty(e.i)||KD.isEmpty(t.i)||e.i==t.i?0:e.i>t.i?1:-1;if(0==r){var o=e.k,n=t.k,a=o&&i.getColumnDescriptor(o),l=n&&i.getColumnDescriptor(n);null==a||null==l?r=0:a.colIndex<l.colIndex?r=1:a.colIndex>l.colIndex?r=-1:a.colIndex==l.colIndex&&(r=0)}return r});for(var o=0;o<r.length;o++){var d=r[o];9999!=d.i&&(d.i=o+1),r[o]=d}return r}catch(c){return KD.writeLog(kendo.format("KDVGridProxy SortLayoutSetting Error:{0}",c.message),"",!0),null}},setColVisible:function(e,t){}})}(jQuery),function(e){var t=window.KDVGridProxy;e.extend(t.prototype,{initPagerData:function(e){var t=e||this.config,i=t.isSplitPage||this.showPager;void 0===t.isSplitPage&&(i=(this.isEditable()?!1:!0)||t.isSplitPage||this.showPager);var r=t.pagerows||t.pageSize||this.pageSize||50,o=KD.getValue(t,"rowcount",0),n=void 0,a=this.maxPageRow=KD.getValue(t,"maxpagerow",this.maxPageRow||KDVGridProxy.C_ListMaxPageCount);if(r>a&&(a=this.getInnerMaxRow(r),r=a),KD.getValue(t,"isSplitPage",!1))n=KD.getValue(t,"pageindex",o>0?1:0);else if(void 0==t.pageindex&&(-1==t.rowcount||t.rowcount>0)&&void 0!=t.startrow){r=r||this.pageSize;var l=parseInt(t.startrow);KD.isNaN(l)||parseInt(t.startrow/r)*r!=t.startrow||(n=parseInt(t.startrow/r)+1)}var s=void 0!=t.forcevisiblepage?t.forcevisiblepage:this.config.forcevisiblepage;if(void 0!=s?this.showPager=s:this.showPager=i,this.showPager){for(var d=KDVGridProxy.getDefaulPageRowStage(),c=d.length-1;c>=0;c--){if(d[c]<a){d.push(a);break}if(d[c]==a)break;d[c]>a&&d.splice(c,1)}var u=e&&e.rows&&e.rows.length||0;this.config.pager={rowList:d,rowNum:r||this.pageSize,pageIndex:n||this.pageIndex||0,pageCount:(o%r>0?1:0)+parseInt(o/r),rowCount:o,maxPageRow:a,isFailureQuery:t.isFailureQuery,currSelectNumber:this._getSelRows().length,isShowCurrSelectNumber:this.isMultiSelectMode(),viceTitle:KD.getValue(t,"viceTitle",""),currentDataRows:u,custompagermodel:t.custompagermodel},this.config.pager.pageIndex>this.config.pager.pageCount&&-1!=o&&(this.config.pager.pageIndex=this.config.pager.pageCount),-1==o&&(this.config.pager.pageIndex=this.config.pager.pageIndex>0?this.config.pager.pageIndex:1),this.initPager()}this.pagerPxy&&this.pagerPxy.el&&(this.showPager?this.pagerPxy.el.show():this.pagerPxy.el.hide())},initPager:function(){var t=this,i=t.config;if(i.pager){if(i.pager=e.extend(i.pager||{},{id:t.key,dock:KD.dock.Bottom,hasPhantom:t.isFlowViewList(),height:t.pagerHeight}),t._customPagerModel=i.pager.custompagermodel||t._customPagerModel||i.custompagermodel||!1,t.pagerPxy)t.pagerPxy.reloadData.call(t.pagerPxy,i.pager);else{var r=t.pagerPxy=new KDPagerProxy(i.pagerstyle||i.pager.pagerstyle);r.scope=t,r.gotoPageCallBack=t.isEditable()?t.switchPage:t.gotoPage,r.setControlFactoryProxy.call(r,t.getControlFactoryProxy()),r.baseId=t.baseId+"-pager",r.createControl.call(r,i.pager),r.loadConfig.call(r,i.pager),i.pager.hasPhantom?(r.phantomProxy.el.appendTo(t.pagerCt),t.gridPanel.before(t.pagerCt)):(r.el.appendTo(t.pagerCt),t.gridPanel.after(t.pagerCt))}t.doLayout.call(t)}},getColPager:function(){return this.colPagerProxy},getPageCols:function(){return this.pageCols||0},isEnableColPager:function(){var e=!1,t=this.getColPager(),i=this.config||{},r=i.enableColPager||!1;return(r||!KD.isEmpty(t))&&this.getPageCols()>0&&(e=!0),e},gotoPage:function(e,t,i){var r=this;r.pageSize=t,r.pageIndex=e;var o=i?-1:(e-1)*r.pageSize;r.isInit||r.refreshData(o,r.pageSize,i)},switchPage:function(e,t,i,r){var o=this;o.pageSize=t,o.pageIndex=e;var n=(i?-1:(e-1)*o.pageSize,o.getFormProxy());if(n)switch(r){case KDPagerProxy.PageOption.First:case KDPagerProxy.PageOption.Previous:case KDPagerProxy.PageOption.Next:case KDPagerProxy.PageOption.Last:case KDPagerProxy.PageOption.GoTo:n.lockControl.call(n,o),o._customPagerModel?n.fireCustomEvents.call(n,o.getKey(),"CustomPagerModelGoto",o.pageIndex):n.fireEvent.call(n,"EntryGotoPage",o.getKey(),o.pageIndex);break;case KDPagerProxy.PageOption.SizeChange:n.lockControl.call(n,o),o._customPagerModel?n.fireCustomEvents.call(n,o.getKey(),"CustomPagerModelSizeChange",o.pageSize):n.fireEvent.call(n,"EntrySetPageSize",o.getKey(),o.pageSize);break;default:n.lockControl.call(n,o),o._customPagerModel?n.fireCustomEvents.call(n,o.getKey(),"CustomPagerModelSwitchPage",KDPagerProxy.GetOperationName(r)):n.fireEvent.call(n,"EntrySwitchPage",o.getKey(),KDPagerProxy.GetOperationName(r))}}})}(jQuery),function(e){window.KDVColumnDescriptorFactory={columnDescTypes:{},columnDescListTypes:{},create:function(e,t){var i="kdvcol_default",r=e.editor;r&&r.xtype?i=r.xtype:"kdpic2field"==e.xtype&&(i=e.xtype),"kdcombo"==i&&KD.getValue(r,"isMulti",!1)&&(i="kdmulticombo");var o=e.dataIndex;if(!o)return null;o==t.serverIndexFieldName&&(i="idcolumn");var n=null,a=KDVColumnDescriptorFactory.columnDescTypes[i];a&&"kdvcol_default"!=i||(i=e.xtype,a=KDVColumnDescriptorFactory.columnDescListTypes[i]),n=a?new a:new KDVColumnDescriptor,n.setGridStore.call(n,t),n.loadConfig.call(n,e);var l=n.xColDspCtrlType;return KDVColumnDescriptorFactory.createDisplayDescriptor(i,l,n),n},createDisplayDescriptor:function(e,t,i){if(!t)return void delete i.displayDescriptor;var r=KDVColumnDescriptorFactory.columnDescTypes[e+"_"+t];if(r||(r=KDVColumnDescriptorFactory.columnDescTypes[t]),r){var o=new r,n=i.gridStore,a=i.config;o.setTargetDescriptor.call(o,i),o.setGridStore.call(o,n),o.loadConfig.call(o,a),i.displayDescriptor=o}}},window.KDVColumnDescriptorFactory.registerType=function(e,t){KDVColumnDescriptorFactory.columnDescTypes[e]=t,t.xtype=e},window.KDVColumnDescriptorFactory.registerListType=function(e,t){KDVColumnDescriptorFactory.columnDescListTypes[e]=t,t.xtype=e}}(jQuery),function(e){var t=window.KDVColumnDescriptor=window.KDVColumnDescriptor||function(){this.initExtCellTemplate()};e.extend(t,{extMap:{QualityStandard:"getQSTemplate"},getExtTemplateMethod:function(e,t){var i=KDVColumnDescriptor.extMap[e];return t?t[i]:void 0}}),e.extend(t.prototype,{initExtCellTemplate:function(){KDVColumnDescriptor.QSCellTemplate||e.extend(KDVColumnDescriptor,{QSCellTemplate:{top:'<div class="kd-grid-celldiv" style="min-height:34px"><span class="kd-grid-qs-top"></span></div>',singleDownArrow:'<div class="kd-grid-celldiv" style="min-height:34px"><div><span class="kd-grid-qs-ArrowSpace"></span></div><div><span class="kd-grid-qs-ArrowPin"></span></div><span class="kd-grid-qs-downArrow"></span></div>',downArrow:'<div class="kd-grid-celldiv" style="min-height:34px"><div><span class="kd-grid-qs-ArrowPin"></div></span><span class="kd-grid-qs-singleDownArrow"></span></div>',bottom:'<div class="kd-grid-celldiv" style="min-height:34px"><span class="kd-grid-qs-bottom"></span></div>',middle:'<div class="kd-grid-celldiv" style="min-height:34px"><span class="kd-grid-qs-middle"></span></div>',upArrow:'<div class="kd-grid-celldiv" style="min-height:34px"><div><span class="kd-grid-qs-ArrowSpace"></span></div><span class="kd-grid-qs-upArrow"></span><div><span class="kd-grid-qs-ArrowPin"></span></div></div>',singleUpArrow:'<div class="kd-grid-celldiv"><span class="kd-grid-qs-singleUpArrow"></span><div><span class="kd-grid-qs-ArrowPin"></span></div></div>'}})},getQSTemplate:function(e,t){var i=this,r=(i.getGridStore(),t.rowId),o=i.getSvrValue(r),n="";if("↓"!=o&&"↑"!=o)return i.getTemplateCore(e,t);var a=(i.getOwner(),r-1),l=r+1,s=i.getSvrValue(a),d=i.getSvrValue(l),n=i.getQSCellTempKey(o,s,d);return n?KDVColumnDescriptor.QSCellTemplate[n]:i.getTemplateCore(e,t)},getQSCellTempKey:function(e,t,i){var r="top",o="downArrow",n="singleDownArrow",a="middle",l="upArrow",s="singleUpArrow",d="bottom",c="↓",u="↑",g="";return t==c?e==c?g=i==c?a:o:e==u&&(g=i==u?l:s):t==u?e==u?g=i==u?a:d:e==c&&(g=i==c?r:n):e==c?g=i==c?r:n:e==u&&(g=i==u?l:s),g}})}(jQuery),function(e){e.extend(KD,{vEntryCellBtnClick:function(e){event.stopPropagation();var t=ClientAppProxy.Current,i=t.getAliveForm.call(t,e.pageid);if(i){var r=JSON.stringify({key:e.key,row:e.row}),o=i.getControlProxy.call(i,e.entrykey);o&&void 0!=o.setFocusRowIndex&&o.setFocusRowIndex.call(o,e.row,!0),KD.getValue(e,"sync",!0)?i.fireSyncCustomEvents.call(i,e.entrykey,"EntryCellBtnClick",r):i.fireCustomEvents.call(i,e.entrykey,"EntryCellBtnClick",r)}},vEntryLargetextClick:function(e){var t=ClientAppProxy.Current,i=t.getAliveForm.call(t,e.pageid),r=i.getControlProxy.call(i,e.entrykey);r.setFocusRowIndex.call(r,e.row,!0),KD.delayInvoke(function(){var t=new FormManager,i=new ShowFormParameter("BOS_LargeTextEdit");i.CustomParams.FieldKey=e.key,i.CustomParams.AllowEdit=!1,i.CustomParams.parentPageId=e.pageid,t.ShowClientDynamicForm.call(t,i)},200)},vEntryLinkBtnClick:function(e,t){event.stopPropagation();var i=ClientAppProxy.Current;if(KD.isString(e))try{e=KD.parseObject(e)}catch(r){e=KD.htmlUtil.decode(e),e=KD.parseObject(e)}if(!KD.isEmpty(e)){var o=i.getAliveForm.call(i,e.pageid);if(o){var n=o.getControlProxy.call(o,e.entrykey);if(!n)return;n.setFocusRowIndex.call(n,e.row,!0),KD.isEmpty(e.itemid)||KD.isEmpty(e.attrname)||n.el.find("#"+e.itemid).attr(e.attrname,"true"),KD.delayInvoke(function(){o.lockControl.call(o,n),KD.isEmpty(t)?KD.getValue(e,"sync",!0)?o.fireSyncEvent.call(o,"EntryButtonCellClick",e.entrykey,e.key,e.row):o.fireEvent.call(o,"EntryButtonCellClick",e.entrykey,e.key,e.row):KD.getValue(e,"sync",!0)?o.fireSyncEvent.call(o,"EntryButtonCellClickExt",e.entrykey,e.key,e.row,t):o.fireEvent.call(o,"EntryButtonCellClickExt",e.entrykey,e.key,e.row,t)},50)}}},vEntryButtonClick:function(e,t){KD.vEntryLinkBtnClick(e,t)},vEntryPictureFileClick:function(e){var t=ClientAppProxy.Current;if("string"==typeof e)try{e=KD.parseObject(e)}catch(i){e=KD.htmlUtil.decode(e),e=KD.parseObject(e)}var r=t.getAliveForm.call(t,e.pageid);if(r){var o=r.getControlProxy.call(r,e.entrykey);if(e.key){var n=o.getStore(),a=null==n?null:n.getColumnDescriptor(e.key);if(a&&a.PictureFileClick){var l=window.event||arguments.callee.caller.arguments[0];e.target=l.currentTarget,a.PictureFileClick.call(a,e,event)}}}}})}(jQuery),function(){$.extend(window.KDVColumnDescriptor.prototype,{isDataMasking:void 0,dataMaskingControlLists:["textfield","kdtextarea","kdlangtextarea","kdlangtextfield","numberfield","datefield","datetimefield"],setIsMk:function(e){var t=this;t.isDataMasking=e;var i=t.getOwner();if(!i)var r=this.getGridStore(),i=r&&r.getOwner&&r.getOwner();i&&i.setEnableColumnMkModel&&i.setEnableColumnMkModel.call(i,t.dataIndex,e)},setMkVal:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.MkVal,e,t)},setMkModel:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.MkModel,e,t)},getMkModel:function(e,t){var i=void 0;return this.isDataMasking&&(i=this.getDimensionValue(KD.KDVGridActionKeys.MkModel,e),KD.isEmpty(i)&&(i=KD.getValue(this.config,"MkModel",void 0),KD.isEmpty(i)&&this.config&&(i=KD.getValue(this.config.editor,"MkModel",KD.CONST.DataMaskModel.Normal)))),i},getDisplayValueByMkModel:function(e,t,i){var r=this.getIsShowDataMkModel(t,i);if(r){var o=this.getOwner(),n=o&&o.isViewGrid();n||(e=this.getDimensionValue(KD.KDVGridActionKeys.MkVal,t),KD.isEmpty(e)&&(e=""))}return e},getTemplateByMkModel:function(e,t){var i=this,r=this.getMkModel(e,t),o="";if(r==KD.CONST.DataMaskModel.Normal&&i.dataMaskingControlLists.indexOf(i.xtype)>=0){
var n=KD.getImageUrlByNameAndVersion("kd_icon_extend.png");o=KD.format('<div class="kd-btn-desensitize-container" tabIndex="-1" title="{1}"><input type="button" class="kd-icon-btn-desensitize" style="background-image:url({0});"></div>',n,KD.getDataMaskTextTips())}return o},getIsShowDataMkModel:function(e,t){var i=void 0;if(this.isDataMasking){var r=this.getMkModel(e,t);i=r==KD.CONST.DataMaskModel.Normal||r==KD.CONST.DataMaskModel.Locked?!0:!1}return i},onMkButtonClick:function(e,t){var i=this,r={};r.entrykey=e,r.fieldkey=i.dataIndex,r.row=t;var o=i.getFormProxy();o&&o.fireEvent.call(o,KD.CONST.CustomEventName.ShowCVPFieldData,i.dataIndex,t)}})}(),function(e){window.KDVStoreBase=function(){},window.KDVStoreBase.prototype={isRedBlue:!1,selColDescriptor:null,setOwner:function(e){this.owner=e},getOwner:function(){return this.owner},getIndexKey:function(){return this.serverIndexFieldName},getSeqKey:function(){return this.seqFieldName},getKeyInputFieldName:function(){return this.keyInputFieldName},isEditable:function(){var e=this.getOwner();return e&&e.isEditable.call(e)},isViewGrid:function(){return this.config&&"VIEWGRID"==this.config.gridtype},isBulkData:function(){var e=this,t=e.selColDescriptor,i=t?t.isBulkData.call(t):!1;return i},isSelColEnable:function(){var e=this.getOwner();return e&&e.isSelColEnable.call(e)},setIsRedBlue:function(e){this.isRedBlue=e},loadConfig:function(e){this.config=e,this.isFetching=!0,this.serverIndexFieldName=e.indexKey||"",this.seqFieldName=e.seqKey,this.keyInputFieldName=e.keyInputField,this.isRowVisibleCallBack=e.isRowVisibleCallBack},initColSelectorModelConfig:function(e){},createColumnModel:function(t){this.colDescripersNameMap={},this.visibleCols=[],this.baseFields={},this.selColIndex=t.length,this.initColSelectorModelConfig(t);var i=this.getSeqKey(),r=this.getIndexKey(),o=this.getOwner(),n=o.config;for(var a in t)if(e.isRunInForIn(a,t)){var l=t[a];KDStore.isColSelector(l.dataIndex)?l.visibleIndex=0:l.visibleIndex=l.colIndex+1;var s=KDVColumnDescriptorFactory.create(l,this);s.setOwner(this.owner),s.isKeyInput=l.dataIndex==this.getKeyInputFieldName(),s.allowHtmlCell=this.config?this.config.allowHtmlCell:void 0,KDStore.isColSelector(l.dataIndex)&&(this.selColDescriptor=s);var d=(s.dataIndex||"").toUpperCase();this.colDescripersNameMap[d]=s,(l.visible||void 0==l.visible)&&this.visibleCols.push(s),s.isF7&&(this.baseFields[s.getFieldName.call(s)]=!0,this.baseFields[s.getVFieldName.call(s)]=!0),e.isEmpty(i)||i!=s.getVFieldName()?!e.isEmpty(i)||e.isEmpty(r)||r!=s.getVFieldName()||e.isEmpty(n.groupColumnsInfo)||s.setSort(1,!0):s.setSort(1,!0)}this.resetVisibleCols()},setFrozenObj:function(e){var t=e||{},i=t.left,r=t.right;i&&(t.left=KDVGridUtils.regularFieldName(i)),r&&(t.right=KDVGridUtils.regularFieldName(r)),this.frozenObj=t},clearData:function(e){this.setData(void 0,e)},setData:function(e,t){var i=this;i.isFetching=!1,i.clearStates(),i.rows=[],e&&$((e.selRows||"").split(",")).each(function(e,t){t&&(i.selectedRows[t]=!0)}),i.visualRows=[],e=e?e:{rows:[]},i.appendRows(e.rows,t),i.currentData=e,i.setSummaryColumns(e.sumColums),i.setSummaryData(e.summary),i.setFmtInfo(e)},updateRowDatas:function(t){var i=this;e.isArray(t)||e.writeLog("KDVStoreBase.updateRowDatas","rowDatas is not array",!0);for(var r=0;r<t.length;r++){var o=i.formateNewRow(t[r]);if(!e.isEmpty(o)&&void 0!==o.rowId)for(var n=0;n<i.rows.length;n++){var a=i.rows[n];if(!e.isEmpty(a)&&a.rowId===o.rowId){i.rows[n]=o;break}}}},getDefaulSelRows:function(){var e=this,t=(e.currentData||{}).selRows||"";return t},setUpdateView:function(e){this.updateView=e},setSummaryColumns:function(t){if(this.setUpdateView(!0),$.isArray(t)){for(var i=[],r=0;r<t.length;r++){var o=t[r],n={fieldKey:o.fieldKey,sumType:o.summaryType};i.push(n)}for(var a=this.config.groupColumnsInfo=this.config.groupColumnsInfo||[],l=-1,r=0;r<a.length;r++){var o=a[r];for(var s in o)if("groupSumColums"==s){l=r;break}}e.isEmpty(i)||(0>l?a.push({groupSumColums:i}):a[l]={groupSumColums:i})}},setSummaryData:function(t){var i=this;if($.isPlainObject(t)){i.sumData=i.sumData||{};for(var r in t)if(e.isRunInForIn(r,t)){var o=i.getColumnDescriptor(r);if(o){var n=o.getVFieldName.call(o);i.sumData[n]=t[r]}}}},clearSummaryData:function(){this.sumData&&(this.sumData={})},setFmtInfo:function(t){var i=t[KDGridFormatInfo.C_FmtInfoCurrency],r=e.parseObject(i);this.currencyFormatInfo=new KDGridFormatInfo(r),this.currencyFormatInfo.init.call(this.currencyFormatInfo),i=t[KDGridFormatInfo.C_FmtInfoNumber],r=e.parseObject(i),this.numberFormatInfo=new KDGridFormatInfo(r),this.numberFormatInfo.init.call(this.numberFormatInfo)},updateCFmtInfo:function(e){var t=$.isArray(e)?e:[e];this.currencyFormatInfo=this.currencyFormatInfo||new KDGridFormatInfo,this.numberFormatInfo=this.numberFormatInfo||new KDGridFormatInfo;for(var i=0;i<t.length;i++){var r=t[i];this.currencyFormatInfo.mergeFormatInfo.call(this.currencyFormatInfo,r)}},getGridFmtInfoMap:function(e){return KDGridFormatInfo.C_NumType_C==e?this.currencyFormatInfo:this.numberFormatInfo},getDataRowCount:function(){return this.currentData&&void 0!=this.currentData.rowcount?this.currentData.rowcount:-1},getRowCount:function(){return this.rows&&void 0!=this.rows.length?this.rows.length:-1},getSelectedIds:function(){var e=this;return e.selectedRows||{}},clearSelectedIds:function(){var e=this;e.selectedRows={}},setSelectedIds:function(t){var i=this;if(e.isArray(t)){i.selectedRows=i.selectedRows||{};for(var r=0;r<t.length;r++){var o=t[r];e.isEmpty(o)||(i.selectedRows[o]=!0)}}},setVisualData:function(e,t){this.visualRows=e.rows,t&&t(this.visualRows)},updateRowDataValue:function(e,t,i){if(e){var r=this.getColumnDescriptor(t);r.editor&&(r.formatDisplayValue?i=null!=r.subColDescriptor?r.formatDisplayValue(r.subColDescriptor.fetchDataByValue(i,r.dataIndex)):r.formatDisplayValue(i):null!=r.subColDescriptor&&(i=r.subColDescriptor.fetchDataByValue(i,r.dataIndex))),e[t]=i}},updateSvrValue:function(e,t,i){var r=this,o=r.getRowIndexByServerRowId(e);this.updateValue(o,t,i,e),this.onCellValueChange&&this.onCellValueChange(o,t,i,e)},updateValue:function(e,t,i,r){var o=this,n=e,a=o.rows[n];a&&(a[t]=i)},getSortFieldName:function(){return this.getIndexKey()+"_defSort"},getSeqColumn:function(){return this.getColumnDescriptor(this.getSeqKey())},initRows:function(){var e=this;return e.rows=e.rows||[],e.rows.scope=this,e.rows},appendRows:function(t,i){var r=this;r.initRows();for(var o in t)if(e.isRunInForIn(o,t)){var n=t[o],a=r.formateNewRow(n);r.rows.push(a)}var l=r.rows[r.rows.length-1];return delete this._serverRowIdMap,delete this.visualRows,i&&i(r.rows),l},insertRows:function(t,i,r,o){var n=this,a={},l={},s=n.getIndexKey();n.initRows(),t=r?t:t+1;var d=n.getRowIndexByServerRowId(t);if(0==this.rows.length)return void this.appendRows(i,o);var c=this.rows[d],u=parseInt(c[s]),g=parseInt(c[this.getSeqKey()]),f=0;for(var p in i)if(e.isRunInForIn(p,i)){var h=i[p],D=n.formateNewRow(h);n.rows.splice(d+f,0,D),f++}for(var y=d;y<n.rows.length;y++){var v=this.rows[y],w=u++;v.rowId!=w&&(a[v.rowId]=w),v[s]=w,v.rowId=w,e.isNaN(g)||(v[this.getSeqKey()]=g++),this.setRowSortNum(v)}var m=n.rows[d];return n.updateDimensionRowIdChange({delIds:l,chgIds:a}),delete this._serverRowIdMap,delete this.visualRows,o&&o(n.rows),m},setRowSortNum:function(e){var t=parseInt(e[this.getIndexKey()]),i="0000000000000000"+t.toString();i=i.substr(i.length-16,16),e[this.getSortFieldName()]=i},getPageId:function(){var e=this,t=e.getOwner(),i=t&&t.getFormProxy.call(t);return i&&i.getPageId.call(i)},getGridKey:function(){var e=this,t=e.getOwner();t&&t.getFormProxy.call(t);return t&&t.getKey.call(t)},formateNewRow:function(t){var i=this,r={gridKey:i.getGridKey(),pageId:i.getPageId()};!this.isEditable()&&t&&t.length==this.selColIndex&&t.push(!1);for(var o in i.colDescripersNameMap)if(e.isRunInForIn(o,i.colDescripersNameMap)){var n=i.colDescripersNameMap[o],a=n&&n.subColDescriptor,l=t[n.colIndex];a&&(l=a.formatEditValue.call(a,l).subValue);var s=n.formatEditValue.call(n,l);if(n.isIndexKeyCol.call(n,i.getIndexKey())){var l=t[n.colIndex],d=parseInt(l);r.rowId=d}KDVStoreBase.setFormatValue(n.getVFieldName.call(n),r,s)}return r},deleteRows:function(t,i){var r=this,o={},n={};null==r.rows&&(r.rows=[]);var a=0;r.rows.length>0&&(a=r.getServerRowId(0),0>a&&(a=0));var l=[],s=void 0;for(var d in t)if(e.isRunInForIn(d,t)){var c=t[d];n[c]=-1;var u=r.getRowIndexByServerRowId(c);s=s||u,l.push(u)}for(var g in l)if(e.isRunInForIn(g,l)){var d=l[g];delete r.rows[d]}var f=[];for(var p in r.rows)if(e.isRunInForIn(p,r.rows)){var h=r.rows[p];e.isNaN(parseInt(p))?f[p]=h:f.push(h)}delete r.rows,r.rows=f;for(var p=0;p<r.rows.length;p++){var D=r.rows[p];if(D){length++;var y=p+a;D.rowId!=y&&(o[D.rowId]=y),D.rowId=y,D[r.getIndexKey()]=D.rowId,r.getSeqKey()&&(D[r.getSeqKey()]=D.rowId+1)}}return r.updateDimensionRowIdChange({delIds:n,chgIds:o}),delete this._serverRowIdMap,delete this.visualRows,i&&i(r.rows),s},getColumnDescriptor:function(e){var t=KDVGridUtils.reverFieldName(e);return this.colDescripersNameMap[t.toUpperCase()]||this.colDescripersNameMap[t]},getColumnDescriptors:function(){return this.colDescripersNameMap},getColumnDescriptorParent:function(e){var t;for(var i in this.colDescripersNameMap){var r=this.colDescripersNameMap[i];if(r.parentkey==e){t=r;break}}return t},getColumnDescriptorsParent:function(e){var t=[];for(var i in this.colDescripersNameMap){var r=this.colDescripersNameMap[i];r.parentkey==e&&t.push(r)}return t},existVisibleCols:function(){return e.isArray(this.visibleCols)&&this.visibleCols.length>0},getVisibleCols:function(){return this.visibleCols},resetVisibleCols:function(){var t=this;if(!e.isEmpty(t.visibleCols)){var i=t.visibleCols=e.quickSort(t.visibleCols,"visibleIndex"),r=t.frozenObj||{},o=t.frozenOptions={leftCols:[],rightCols:[]};if(e.isEmpty(r))return;for(var n=-1,a=i.length,l=(r.left||"").toUpperCase().trim(),s=(r.right||"").toUpperCase().trim(),d=0;d<i.length;d++){var c=i[d].getVFieldName();c==l&&(n=d),c==s&&(a=d)}for(var d=0;n>=d;d++){var c=i[d].getVFieldName();o.leftCols.push(c)}for(var d=a;d<i.length;d++){var c=i[d].getVFieldName();o.rightCols.push(c)}}},setVisibleCol:function(t,i){var r=this.getColumnDescriptor(t);if(r)if(i){var o=!1;for(var n in this.visibleCols)if(e.isRunInForIn(n,this.visibleCols)&&this.visibleCols[n].dataIndex==t){o=!0;break}o||(this.visibleCols.push(r),this.visibleCols=e.quickSort(this.visibleCols,"visibleIndex")),r.setVisible.call(r,!0)}else for(var n in this.visibleCols)if(e.isRunInForIn(n,this.visibleCols)&&this.visibleCols[n].dataIndex==t){this.visibleCols.splice(n,1),r.setVisible.call(r,!1);break}},selRows:function(e){this.selColDescriptor&&this.selColDescriptor.selRows(e)},IsRowVisible:function(e){return this.IsRowVisibleCallBack?this.IsRowVisibleCallBack(e):!0},isBaseField:function(e){var t=this.baseFields||{};return t[e]},updateDimensionRowIdChange:function(t){var i=this.getColumnDescriptors();for(var r in i)if(e.isRunInForIn(r,i)){var o=i[r];o&&o.updateDimensionRowIdChange.call(o,t)}}},$.extend(KDVStoreBase.prototype,{getStates:function(){return this.states||[]},statesKeys:",forecolor,backcolor,disabled,",colStateKeys:",fontbold,NumFmtInfo,xColDspCtrlType,mask,CellHidden,Tooltip,decimalPrecision,",setStates:function(e,t,i){this.states=this.states||[],this.statesKeys.indexOf(i.key)>-1&&this.states.push({colDesc:e,rowData:t,value:i})},clearStates:function(){delete this.states,this.isViewGrid()&&this.clearSummaryData();for(var e in this.colDescripersNameMap){var t=this.colDescripersNameMap[e];t.clearStates.call(t)}var i=this.selColDescriptor;i&&i.reset&&i.reset.call(i)}}),$.extend(KDVStoreBase.prototype,{getRowIndexByRowData:function(e){var t=this.getRowId(e);return ret=this.getRowIndexByServerRowId(t),ret},getRowIndexByServerRowId:function(e){var t=-1;if($.isArray(this.rows))for(var i=0;i<this.rows.length;i++)if(this.getRowId(this.rows[i])==e){t=i;break}return t},getRowId:function(e){if(null==e||void 0==e)return-1;var t=e[this.getIndexKey()];return t},getBaseRowId:function(){var e=this.getFirstRowId(),t=parseInt(e),i=isNaN(t)||0>t?0:t;return i},getFirstRowId:function(){var e=-1;if(this.rows&&this.rows.length){var t=this.rows[0];e=this.getRowId(t)}return e},getLastRowId:function(){var e=-1;if(this.rows&&this.rows.length){var t=this.rows[this.rows.length-1];e=this.getRowId(t)}return e},getNewRowId:function(){var t=0;if(this.rows&&this.rows.length){var i=this.rows[this.rows.length-1];t=this.getRowId(i)}return t=parseInt(t),e.isNaN(t)?t=0:t++,t},isClientNewRow:function(e,t){var i=this,r=!1,o=parseInt(i.getLastRowId()),n=(e||"").toUpperCase()==i.getKeyInputFieldName();return n&&o==t&&(r=!0),r},existRowIds:function(t){var i=[];if(!e.isArray(t))return i;for(var r in t)if(e.isRunInForIn(r,t)){var o=t[r];void 0!==o&&!isNaN(o)&&this.existRowId(o)&&i.push(o)}return i},existRowId:function(e){var t=this.getRowDataByServerRowId(e);return!!t},getRowDataByServerRowId:function(t){if(!this._serverRowIdMap){var i=this.getColumnDescriptor(this.getIndexKey());if(null==i)return null;this._serverRowIdMap={};for(var r in this.rows)if(e.isRunInForIn(r,this.rows)&&!e.isNaN(parseInt(r))){var o=this.rows[r],n=o[this.getIndexKey()],a=parseInt(n);try{this._serverRowIdMap[a]=o}catch(l){throw new Exception(ResManager.LoadKDString("服务端行号字段FIndex出现重复的数据!","099002000000098"))}}}return this._serverRowIdMap[t]},getServerRowId:function(e){if(!this.getIndexKey())return e;this.visualRows&&this.visualRows.length||(this.visualRows=this.rows);var t=this.visualRows[e];if(!t)return e;if(void 0==t[this.getIndexKey()])throw new Exception(ResManager.LoadKDString("索引数据列下标越界，数据与列元数据不匹配。","099002000000099"));var i=t[this.getIndexKey()];return parseInt(i)}}),$.extend(KDVStoreBase,{setFormatValue:function(e,t,i){t[e]=i}})}(KD),function(e){window.KDVDataStore=e.extend(KDVStoreBase,{getSumGroupInfo:function(){for(var t=this,i=t.config.groupColumnsInfo||[],r={},o=0;o<i.length;o++)for(var n in i[o])e.isRunInForIn(n,i[o])&&(r[n]=i[o][n]);for(var a=[],l=r.groupSumColums||[],o=0;o<l.length;o++){var s=l[o];a.push({field:(s.fieldKey||"").toUpperCase(),sumType:t.getAggregateType(s.sumType),formatter:function(e,i){var r=t.getSumGroupDisplayFormatValue.call(t,e,i);return r}})}return{sumCols:a}},getVOptions:function(){var t=this,i=t.owner,r=t.getSumGroupInfo(),o=$.extend(t.getDefaultOptions(),{isFetching:t.isFetching,columnDefs:[],rowData:t.rows||[],selectedRows:t.getSelectedIds(),colFooterHeight:e.isEmpty(t.sumData)&&e.isEmpty(t.config.groupColumnsInfo)?0:27,sumData:t.sumData,sumColumns:r.sumCols,frozenOptions:t.frozenOptions,sorts:{fieldSeq:[]},filters:{},filterRowValues:{},components:{sort:function(e){i.fireSortEvents.call(i,e)},filter:function(e){i.fireFilterEvents.call(i,e)},filterRowChange:function(e){i.firefilterRowChangeEvents.call(i,e)}}}),n=e.getLocalConfiguration()||{};(ClientAppProxy.Current.IsTableVerticalNoLines||n.DisabledGridCellBorder)&&(o.showCellVBorder=!1);var a=e.equalsIgnoreCase(n.SelectRowBackground,n.DefaultRowBackground)?void 0:n.SelectRowBackground||void 0;o.selectRowBackground=a,o.copyOrginalValue=n.CopyGridOrginalValue||!1;for(var l=t.getVisibleCols(),s=o.sorts,d=o.filters,c=!1,u=0;u<l.length;u++){var g=l[u];g.setAllowColumnFiltering(t.getAllowColumnFiltering());var f=g.getColOptions.call(g);if(o.columnDefs.push(f),!c&&f.mergeHeader.indexOf("&")>0&&(c=!0),g.sortType&&(s.fieldSeq.push(f.field),s[f.field]=g.sortType),!e.isEmpty(g.filters)){d[f.field]={filtercolin:{}};for(var p=0;p<g.filters.length;p++){var h=g.filters[p],D=d[f.field].filtercolin={type:"filtercolin",field:f.field,comparer:h.operator,value:[]};if("in"!=h.operator||e.isEmpty(h.value))"eq"==h.operator&&D.value.push({display:e.format("{0}",h.value),value:h.value});else{var y=h.value.trim();y="("==y.substr(0,1)?y.substr(1):y,y=")"==y.substr(y.length-1)?y.substr(0,y.length-1):y;for(var v=y.split(","),w=0;w<v.length;w++)D.value.push({display:e.format("{0}",v[w]),value:v[w]})}}}}return o},getHeaderSeg:function(e,t,i){var r=(e||"").split("&"),o="";return o=i?r.slice(t).join("&"):r.length>t?r[t]:""},arrangeMergedColHeaders:function(e){for(var t=1,i=0;i<e.length;i++){var r=e[i],o=(r.mergeHeader||"").split("&").length;t=t>o?t:o}for(var i=0;i<e.length;i++){for(var r=e[i],o=(r.mergeHeader,(r.mergeHeader||"").split("&").length),n=t-o,a="",l=0;n>l;l++)a+="    &";r.mergeHeader=a+r.mergeHeader}return e},getMergedCols:function(t,i,r){for(var o=this,i=i||{columnDefs:[]},n=i.columnDefs||[],a="",l={},s=0;s<t.length;s++){var d=t[s],c=d.mergeHeader,u=o.getHeaderSeg(a,r),g=o.getHeaderSeg(c,r),f=o.getHeaderSeg(c,r,!0),p=!e.equalsIgnoreCase(u,g);p&&f.indexOf("&")>=0?(l={headerName:g,children:[]},n.push(l)):f.indexOf("&")<0&&(l={}),l.children?l.children.push(d):n.push(d),a=c}for(var s=0;s<n.length;s++){var h=n[s];h.children&&h.children.length>0&&(h.children=o.getMergedCols(h.children,h,r+1))}return n},getDebugVGridOption:function(){var e=this,t=[{headerName:"Make",field:"make"},{headerName:"Model",field:"model"},{headerName:"Price",field:"price"}],i=[{make:"Toyota",model:"Celica",price:35e3},{make:"Ford",model:"Mondeo",price:32e3},{make:"Porsche",model:"Boxter",price:72e3}],r={columnDefs:t,rowData:i};return r=$.extend(e.getDefaultOptions(),r)},getDefaultOptions:function(){var t=this,i=t.rowHeight,r=t.colHeaderHeight||i,o=!!(t.config||{}).showFilterRow,n={themeCls:".kd-v-grid-theme-galaxy",reservedHeight:8,reservedWidth:0,groupDisplayType:"single",rowHeight:i,headerHeight:r,cacheRows:2,cacheCols:2,showRowNum:e.isDebug(),showColNum:e.isDebug(),groupHeaderHeight:i,colFilterRowHeight:o?25:1,pivotGroupHeaderHeight:i,pivotHeaderHeight:i,defaultColDef:{minWidth:100,resizable:!0,sortable:!0,filter:!0,floatingFilter:o,filterParams:{buttons:["reset","apply"]}},components:{sort:function(e){},filter:function(e){},filterRowChange:function(e){}},getRowNodeId:function(e){return e.rowId}};return n},getAggregateType:function(e){var t="count";switch(e){case-1:t="count";break;case 6:t="custom";case 1:t="sum";break;case 2:t="count";break;case 3:t="max";break;case 4:t="min";break;case 5:t="average";break;default:t="count"}return t},getSumGroupDisplayFormatValue:function(e,t){var i=this,r=i.getColumnDescriptor.call(i,e.field),o=r?r.getSumGroupDisplayFormatValue.call(r,e,t):t;return o},setSelected:function(e,t){var i=this;i.selectedRows=i.selectedRows||{},i.selectedRows[e]=!!t},getCurrentRowId:function(){var t=this,i=t.getSelectedIds(),r="";if((i.length||0)>0)for(var o in i)if("length"!==o&&e.isRunInForIn(o,i)&&i[o]){r=o;break}return r},setAllowColumnFiltering:function(e){var t=this;t.allowColumnFiltering=e?!0:!1},getAllowColumnFiltering:function(){var e=this;return void 0==e.allowColumnFiltering?!0:!!e.allowColumnFiltering}})}(KD),function(e){var t=window.KDVColumnDescriptor=window.KDVColumnDescriptor||function(){this.initExtCellTemplate()};e.extend(t.prototype,{minRowHeight:34,allowSorting:!0,allowGrouping:!0,allowColumnFiltering:!0,redBlueCls:KD.numInfo?KD.numInfo.redCellCls:"",states:{},clearStates:function(){this.states={}},setGridStore:function(e){this.gridStore=e,this.formProxy=this.gridStore.owner.getFormProxy()},needRefreshOwner:function(e){return void 0!==e&&(this.refreshOwnerFlag=e),this.refreshOwnerFlag},isBulkData:function(){var e=this,t=e.getGridStore(),i=t?t.getRowCount.call(t):0;return i>KDStore.C_BulkDataLimit},release:function(){delete this.gridStore,delete this.store,delete this.owner,delete this.formProxy,delete this.displayDescriptor,delete this.targetDescriptor},getFormProxy:function(){return this.formProxy||this.gridStore.owner.getFormProxy()},getPageId:function(){var e=this.getFormProxy();return e.getPageId.call(e)},getGridStore:function(){return this.gridStore},getDisplayDescriptor:function(){return this.displayDescriptor},loadConfig:function(t){this.visible=KD.getValue(t,"visible",!0),this.config=t,this.header=KD.getValue(this.config,"header",""),this.setIsRedBlue(KD.getValue(this.config,"isRedBlue",!1)),this.width=KD.getValue(t,"width",100),e.extend(this,t),this.editor&&(this.xColDspCtrlType=this.xColDspCtrlType||this.editor.xColDspCtrlType,this.xtype=this.xtype||this.editor.xtype,this.fireUpdate=!!this.editor.fireUpdate,this.config.fireUpdate=this.fireUpdate);var i=KD.getValue(t,"flexcolindex",-1);null!=i&&-1!=i&&(this.subColDescriptor=new KDFlexColumnDataController,this.subColDescriptor.loadConfig.call(this.subColDescriptor,t));var r=KD.getValue(this.config,"IsMk","");KD.isEmpty(r)||this.setIsMk(r)},getFieldName:function(){return this.dataIndex},getVFieldName:function(){return this.converFieldName(this.getFieldName())},converFieldName:function(e){return KDVGridUtils.regularFieldName(e)},isIndexKeyCol:function(e){return e||(e=this.owner&&this.owner.store&&this.owner.store.getIndexKey.call(this.owner.store)),KD.equalsIgnoreCase(e,this.getVFieldName())},colPageFixed:function(){var e=this;return e.config?!!e.config.isColPageFixed:!1},getTargetDescriptor:function(){return this.targetDescriptor},setTargetDescriptor:function(e){this.targetDescriptor=e},getCaption:function(){return this.header},setCaption:function(e){var t="col",i=-1,r=KD.KDVGridActionKeys.Caption;this.header=e||"",this.headerText=e||"",this.config.header=e||"",this.propertyChange(r,t,i)},setHeader:function(e){this.setCaption(e)},setHeaderAlignment:function(e){var t="col",i=-1,r=KD.KDVGridActionKeys.HeaderAlignment;this.config[r]=e||"",this[r]=e||"",this.propertyChange(r,t,i)},getWidth:function(){return this.width},setWidth:function(e){var t="col",i=-1,r=KD.KDVGridActionKeys.Width;this.width=e,this.config.width=e,this.propertyChange(r,t,i)},setFireUpdate:function(e){var t="col",i=-1,r=KD.KDVGridActionKeys.FireUpdate;this.fireUpdate=e,this.config.fireUpdate=e,this.propertyChange(r,t,i)},setMustInput:function(e){var t="col",i=-1,r=KD.KDVGridActionKeys.MustInput;this.mustInput=e,this.config.mustInput=e,this.propertyChange(r,t,i)},setXColDspCtrlType:function(e){var t=this.xColDspCtrlType=this.config.xColDspCtrlType=e;KDVColumnDescriptorFactory.createDisplayDescriptor(t,this);var i="col",r=-1,o=KD.KDVGridActionKeys.xColDspCtrlType;this.propertyChange(o,i,r)},setIsRedBlue:function(e){var t="col",i=-1,r=KD.KDVGridActionKeys.IsRedBlue;this.IsRedBlue=e,this.config.isRedBlue=e,this.config.editor&&(this.config.editor.isRedBlue=e),this.propertyChange(r,t,i)},getIsRedBlue:function(e){return this.IsRedBlue},setAllowAutoList:function(e){var t="col",i=-1,r=KD.KDVGridActionKeys.AllowAutoList;this.AllowAutoList=e,this.config.AllowAutoList=e,this.propertyChange(r,t,i)},setShowEditButton:function(e){var t="col",i=-1,r=KD.KDVGridActionKeys.ShowEditButton;this.editor&&(this.editor.showEditButton=e),this.propertyChange(r,t,i)},locked:function(e,t){var i=!1;return void 0!==e?(i=e,t?this.lockedType=i:this.orginLockedType=i):i=KD.isEmpty(this.lockedType)?KD.getValue(this.config,"locked",this.orginLockedType||!1):this.lockedType,i},tooltipEnabled:function(e){return void 0!==e&&(this.config.tooltipenabled=e),KD.getValue(this.config,"tooltipenabled",!1)},setLookup:function(e){var t="col",i=-1,r=KD.KDVGridActionKeys.ShowEditButton;this.editor&&(this.editor.lookup=e),this.propertyChange(r,t,i)},setExAndUrl:function(t){var i="col",r=-1,o=KD.KDVGridActionKeys.ExAndUrl,n={exExtandUrl:t};this.config&&this.config.editor?e.extend(this.config.editor,n):this.config&&e.extend(this.config,n),e.extend(this,n),this.propertyChange(o,i,r)},setExDownloadUrl:function(t){var i="col",r=-1,o=KD.KDVGridActionKeys.ExDownloadUrl,n={exDownloadUrl:t,isfileserver:!!t};this.config&&this.config.editor?e.extend(this.config.editor,n):this.config&&e.extend(this.config,n),e.extend(this,n),this.propertyChange(o,i,r)},getDimensionValue:function(e,t){if(void 0===t&&this.editor)return this.editor[e];var i=this.states[e]||{},r=i[t];return r},updateDimensionValue:function(t,i,r){var o=this.editor&&!i?"col":"cell",n=-1;if(this.editor&&!i)this.editor[t]=r,this.config.editor[t]=r;else if(e.isPlainObject(r)){this.states[t]=this.states[t]||{};var a=this.states[t],l=this.getGridStore();for(var n in r)KD.isRunInForIn(n,r)&&(a[n]=r[n])}else{this.states[t]=this.states[t]||{};var a=this.states[t],l=this.getGridStore();n=l.getRowId.call(l,i),a[n]=r}this.propertyChange(t,o,n)},updateDimensionRowIdChange:function(e){var t=e.delIds,i=e.chgIds;for(var r in this.states)if(KD.isRunInForIn(r,this.states)){var o=this.states[r];if(t)for(var n in t)KD.isRunInForIn(n,t)&&-1==t[n]&&delete o[n];if(i){var a={};for(var n in o)if(KD.isRunInForIn(n,o)){var l=i[n];void 0!==l&&o[n]?a[l]=o[n]:void 0===l&&(a[n]=o[n])}this.states[r]=a}}},isVisible:function(){var e=this;return void 0===e.visible?!0:e.visible},setVisible:function(e){this.visible=this.config.visible=e},setUndisabled:function(e,t){this.setDisable(e,!t)},setDisabled:function(e,t){this.setDisable(e,t)},setDisable:function(e,t){this.editor&&!e&&(this.editor.disabled=t,this.config.editor.disabled=t),this.updateDimensionValue(KD.KDVGridActionKeys.Disabled,e,t)},isColDisabled:function(){var e=this;return void 0===e.config.editor||KD.getValue(e.config.editor,"disabled",!1)},isDisabled:function(e){var t=this,i=!1,r=t.getOwner();if(t.isIndexKeyCol())return!0;if(t.isForBatchFilter)return!1;var o=i=t.isColDisabled();if(o)return!0;if(!r||r.isTreeList&&r.isReadOnlyRow.call(r,e))return!0;var n=t.getGridStore();if(!i){var a=n.getRowId.call(n,e);i=t.getDimensionValue(KD.KDVGridActionKeys.Disabled,a)}if(!i){var l=n.getIndexKey.call(n),s=n.getColumnDescriptor.call(n,l);i=s.getDimensionValue.call(s,KD.KDVGridActionKeys.Disabled,a)}return KD.isArray(i)&&void 0!=i.disabled?i.disabled:i},setColor:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.Forecolor,e,t)},setForecolor:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.Forecolor,e,t)},setBackcolor:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.Backcolor,e,t)},setDecimalPrecision:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.DecimalPrecision,e,t)},setDecimalIntLength:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.DecimalIntLength,e,t)},setMaxValue:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.MaxValue,e,t)},setMinValue:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.MinValue,e,t)},setFontbold:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.Fontbold,e,t)},setTooltip:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.Tooltip,e,t)},setCellHidden:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.CellHidden,e,t)},setMask:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.Mask,e,t)},setNumFmtInfo:function(e,t){this.updateDimensionValue(KD.KDVGridActionKeys.NumFmtInfo,e,t)},setSplitPattern:function(e){var t="col",i=-1,r=KD.KDGridActionKeys.SplitPattern;this.splitPattern=e,this.config.splitPattern=e,this.propertyChange(r,t,i)},propertyChange:function(e,t,i){},getEditorStyleKey:function(){var e="";return e=this.editor?this.editor.stylekey||"":""},getDisable:function(){var e=!!this.editor;return this.editor&&(e=!KD.getValue(this.editor,"disabled",!1)),!e},getIndex:function(){return this.colIndex},getIsForBatchFilter:function(){return this.isForBatchFilter},setOwner:function(e){this.owner=e;var t=this.displayDescriptor;t&&KD.isFunction(t.setOwner)&&t.setOwner.call(t,e)},getOwner:function(){return this.owner},getOwnerKey:function(){return this.owner.getKey.call(this.owner)},setStore:function(e){this.config.store=e},isCellEditorMode:function(){return this.editor},getAttributesClass:function(){var e="",t=this.isTreeExpander();if(t){var i=this.isColDisabled();i&&(e=" kdgrid-td-state-disable")}return e},getTextAlign:function(){if(this.editor&&"numberfield"==this.xtype)return"right";var e=this.config,t=KD.getValue(e,"defaultColAlignType",-1),i=KD.getValue(e,"colAlignType",t);return 0==i&&(i=t),1==i?"left":2==i?"right":3==i?"center":void 0!=this.editor&&"numberfield"==this.xtype?"right":"left"},checkIsListMultiSel:function(e){if((" "==e||e==ResManager.LoadKDString("选择","0991733000003932"))&&"kdcheckbox"==this.xtype){var t=this.getOwner();t.setIsListMultiSel(!1)}},isButtonType:function(e){var t=!1;return t="kdbutton"==(e||this.xColDspCtrlType)},isLinkType:function(e){var t=!1;return t="kdlinkbutton"==(e||this.xColDspCtrlType)},isPictureType:function(e){return"kdpicture"==(e||this.xColDspCtrlType)},isUrlPictureType:function(e){return"kdurlpicfield"==(e||this.xColDspCtrlType)||"kdpic2field"==(e||this.xColDspCtrlType)},isCellCustDisplayOnly:function(){return!0},getCellCustFormatString:function(e){var t=this.getSvrValue(e);return t},getCellCustUnformatString:function(e,t){var i=this.getSvrValue(e);return i},createCellCustEditor:function(e,t){return!1},showCellCustEditor:function(e){return!1},clearCellCustEditor:function(e,t){return!1},getDisplayValue:function(e,t,i){var r="";return void 0===e?r:KD.isArray(e)?e[0]||"":(r=void 0!==(e||{}).text?e.text:e,KD.convertToHtmlString(this.allowHtmlCell?r:KD.htmlUtil.encode(r))||"")},getCompareValue:function(e,t,i){var r="";return void 0===e?r:KD.isArray(e)?e[1]||"":r=void 0!==(e||{}).value?e.value:e},getSvrValue:function(e){var t=this,i="",r=void 0,o=t.getVFieldName();if(KD.isObject(e))r=e;else{var n=t.getGridStore();r=n.getRowDataByServerRowId.call(n,e)}return i=r?r[o]:void 0},setSvrValue:function(e,t){var i=this,r=i.getGridStore(),o=i.getVFieldName(),n=i.getSvrValue(e),a=i.subColDescriptor,l=t;l=a?a.formatEditValue(t).subValue:i.formatEditValue(t),n==l||n&&KD.stringify(n)==KD.stringify(l)||r.updateSvrValue.call(r,e,o,l)},getOriginalValue:function(e){return this.getSvrValue(e)},getValue:function(e){var t=this.getGridStore(),i=t.rows[e];return this.getValueByRowData(i)},getValueByRowData:function(e,t){var i=(this.getVFieldName()||"").toUpperCase();if((t||i||"").toUpperCase()!=i){var r=this.getGridStore(),o=r.getColumnDescriptor.call(r,t),n=o.getValueByRowData.call(o,e);return void 0===n?"":n}return null!=this.subColDescriptor?this.subColDescriptor.fetchData.call(this.subColDescriptor,e,i):(e||{})[i]||""},setValue:function(e,t){var i=this.getGridStore(),r=i.rows[e],o=this.getVFieldName();null!=this.subColDescriptor&&this.subColDescriptor.commitData.call(this.subColDescriptor,r,o,t),i.updateValue.call(i,e,o,t)},isKeyInputCell:function(e){var t=this.getGridStore();return this.isKeyInput&&e==t.getLastRowId.call(t)},initCellEditor:function(e,t,i){},getCellEditorTemplate:function(e,t){return"<input>"},initCellEditorComponent:function(e,t){},beforeCreateEditorProxy:function(e,t){},beforeInitCellEditorComponent:function(e,t){},afterInitCellEditorComponent:function(e,t){var i=this,r=t.model.rowId,o=i.getSvrValue(r);this.proxy&&this.proxy.component&&this.proxy.setValue(o)},onchange:function(t,i,r){var o=this.wrapSetValue(t,i,r),n=this.formatEditValue(o),a=this.getOwner(),l=!!a&&a.store,s=a.getFormProxy.call(a);if(this.isKeyInputCell(r.model.rowId)&&s.fireCustomEvents.call(s,a.getKey.call(a),"PostDataOnly",""),l.setFormatValue(r.field,r.model,n),e.isPlainObject(n))for(var d in n)if("name"==d||"text"==d)r.model.set(r.field,n[d]);else{var c=KD.format("{0}.{1}",r.field,d);c=KDVGridUtils.regularFieldName(c),r.model[c]=n[d]}else r.model.set(r.field,n)},formatEditValue:function(e){return e},wrapSetValue:function(e,t,i){return t},getFilter:function(){return this.filter||[]},resetFilter:function(){this.filter=[]},setFilter:function(e){this.filter||(this.filter=[]),KD.isObject(e)?this.filter.push({field:this.dataIndex,operator:e.operator||"eq",value:e.value}):this.filter.push({field:this.dataIndex,operator:"eq",value:e})},resetSort:function(){this.sortType=this.orginSortType||""},setSort:function(e,t){var i=void 0;if(void 0===e||""==e)i=e;else switch(e){case 0:i="asc";break;case 1:i="desc";break;case"asc":case"desc":i=e}t&&(this.orginSortType=i),this.sortType=i},getSort:function(){return this.sortType},getSchemaModel:function(){var e="string";if(this.gridEditable)switch(this.xtype||this.editor&&this.editor.xtype){case"numberfield":e="number";break;case"kdcheckbox":e="boolean"}return this.isIndexKeyCol()&&(e="number"),{type:e,editable:!0,nullable:!0}},getColOptions:function(t){
var i=this,r=i.getGridStore(),o=(((r||{}).config||{}).showFilterRow,i.header.split("&")),n=this.headerText=o.length>0?o[o.length-1]||" ":" ";i.checkIsListMultiSel(n);var a=(i.header?i.header.substr(0,i.header.length-n.length-1):"",i.getVFieldName()),l=(i.getWidth(),{__colScope__:i,mergeHeader:i.header,width:i.getWidth(),headerName:n,field:a,align:i.getTextAlign(),sortable:i.allowSorting,groupable:i.allowGrouping,filterable:i.allowColumnFiltering,editable:!i.isColDisabled(),valueGetter:i.valueGetter,calcValueGetter:i.calcValueGetter,dispalyValueGetter:i.dispalyValueGetter,sortValueGetter:i.sortValueGetter,filterValueGetter:i.filterValueGetter,cellEditor:i.cellEditor,cellEditorParams:i.cellEditorParams,comparator:function(e,t,r,o,n){var a=i.sortCompare.call(i,e,t,r,o,n);return a},template:i.getTemplate,headerTemplate:i.createHeaderTemplate(),displayType:i.getDisplayType(),attrData:{xtype:i.xtype,xColDspCtrlType:i.xColDspCtrlType}}),s=i.getColEditorOption();return e.extend(l,s),l},getDisplayType:function(){var e=this,t="",i=e.xColDspCtrlType||"";switch(i){case"kdlinkbutton":t="link";break;case"kdbutton":t="button";break;default:t="text"}return t},dispalyValueGetter:function(e){var t="",i=e.colDef,r=i.__colScope__,o=e.data,n=o.rowId,a=o[i.field]||"";return t=n?r.getDisplayValue.call(r,a,n,o):""},sortValueGetter:function(e){var t="",i=e.colDef,r=i.__colScope__,o=e.data,n=o.rowId,a=o[i.field]||"";return t=n?r.getCompareValue.call(r,a,n,o):""},filterValueGetter:function(e){var t="",i=e.colDef,r=i.__colScope__,t=r.valueGetter.call(r,e);return t},valueGetter:function(e){var t="",i=e.colDef,r=(i.__colScope__,e.data);return t=r[i.field]||""},calcValueGetter:function(e){var t="",i=e.colDef,r=i.__colScope__,o=e.data,n=o.rowId,a=o[i.field]||"";return t=n?r.getCompareValue.call(r,a,n,o):""},getSumGroupDisplayFormatValue:function(e,t){return t},getTemplate:function(e){var t="",i=e.colDef,r=i.field,o=e.data,n=i.__colScope__,a=n.getGridStore(),l=a&&a.cellTemplateKey?KDVColumnDescriptor.getExtTemplateMethod(a.cellTemplateKey,n):"";return t=l?l.call(n,r,o):n.getTemplateCore.call(n,e)},getTemplateCore:function(t){var i="",r=t.colDef,o=r.field,n=r.__colScope__,a=t.data,l=n.getGridStore(),s=n.getOwner(),d=a.rowId;if(!s||s.isTreeList&&s.isWaitingRow.call(s,a))return"";var c=l.getIndexKey.call(l),u=l.getColumnDescriptor.call(l,c),g=n.getDimensionValue(KD.KDVGridActionKeys.Forecolor,d)||u.getDimensionValue.call(u,KD.KDVGridActionKeys.Forecolor,d),f=n.getDimensionValue(KD.KDVGridActionKeys.Backcolor,d)||u.getDimensionValue.call(u,KD.KDVGridActionKeys.Backcolor,d),p=(n.getDimensionValue(KD.KDVGridActionKeys.CellHidden,d),n.getDimensionValue(KD.KDVGridActionKeys.Tooltip,d)||{}),h=void 0===p.E?n.tooltipEnabled():p.E,D=p.T||"",y=n.getDimensionValue(KD.KDVGridActionKeys.CellHidden,d)||{},v=n.isDisabled(a),w=n.editor&&n.editor.EmptyTip?n.editor.EmptyTip:"";if(v&&!f){n.gridEditable&&(f="#");var m=l.defaultDisabeCellBackground;m&&(f=m)}var K={disable:v,backcolor:f,forecolor:g,field:o,tooltipEnabled:h,tooltip:D,hiddenEnabled:y.H,hiddenMask:y.M,rowData:a,rowId:d,emptyTip:w};if(n.displayDescriptor){var C=e.extend({value:n.displayDescriptor.getDisplayValue.call(n.displayDescriptor,a[o],d,a),attrCellDataStr:n.getAttrCellDataStr(d,o)},K);i=n.displayDescriptor.getDisplayTemplate.call(n.displayDescriptor,C)}else i=n.createTemplate(K);return i},createTemplate:function(e){var t=this,i=t.getGridStore(),r=e&&e.backcolor,o=e&&e.forecolor,n=e&&e.disable,a=e&&e.emptyTip,l="",s=i.rowHeight;if(i.rowHeight<t.minRowHeight){var d=t.getFormProxy();(d.dformConfig||d.config).isUseSmallScreenModel||(s=t.minRowHeight)}var c=s?"min-height:"+s+"px;":"",u=e.field,g=t.getOwner(),f=e.rowData,p=f.rowId,h=t.getAttrCellDataStr(p,u),D=f;if(void 0===D)return"";t.isTreeExpander()&&(c+="display: inline;opacity:1; background-color:transparent; color:#000000;",r="");var y=g.isViewGrid(),v=n&&!y?"k-gridCellstate-disabled":"",w=n&&!y?" tabindex='9999999' ":" ",m="",K=t.getIsRedBlue()||i.isRedBlue?t.redBlueCls||"":"",C=void 0!=D?t.getValueByRowData(D,u):"";if(e.hiddenEnabled&&e.hiddenMask&&(C=e.hiddenMask),~(this.allowHtmlCell?C:KD.htmlUtil.encode(C)).search(/\r\n|\n/g)){var S=2,I=12,V=KD.convertToHtmlString(KD.htmlUtil.encode(C||"")).split("<br/>").length;V>1&&(S=V);var x=i.rowHeight/S;I>x&&(x=I),c+="line-height:"+x+"px;",x*S>i.rowHeight&&(c+="height:"+i.rowHeight+"px;")}var k="",F=e.tooltipEnabled?e.tooltip||C:"",R=F?' title="'+KD.htmlUtil.encode(F).replace(/\"/g,"&quot;")+'"':"",b=F?'<span class="kd-grid-tipflag" style="min-height: 4px;"></span>':"",P=t.getDisplayValue(C,p,D),M=this.getTemplateByMkModel(p,D);KD.isEmpty(P)&&!KD.isEmpty(a)?l="color:#999":a="";var G=KD.getFontFamilyByCurrencySymbol(P);KD.isEmpty(G)||(k=KD.format("font-family:{0};",G));var A=t.getTextAlign(),E=("right"==A?"padding-right:":"padding-left:")+"5px;",N=ClientAppProxy.Current.IsIgnoreGridCellColorTrans?"kd-grid-celldiv-ignorecellopcity":"",T="",_=/<[^>]+>/gi.test(P)?P:KD.format("<span>{0}</span>",P);if(r){var L=L=o?"color:"+o+";":"color:#000000;";(void 0==n||0==n)&&(L="",r=""),T=k+"background-color:"+r+"; text-align:"+A+";"+c+L,m=KD.format('<div {0} class="{1} kd-grid-celldiv {2} {9}" style = "{3}">{4}<span class="kd-grid-cellspan" {5} style="{6}">{7}{8} {10}</span></div>',w,K,v,T,b,h+R,k+c+E+l,_,a,N,M)}else{var L=o?"color:"+o+";":"";T=E+k+c+L+"text-align:"+A+";"+l,m=KD.format('<span {0} class="{1} kd-grid-cellspan {2}" {3} style="{4}">{5}{6}{7} {8}</span>',w,K,v,h+R,T,_,a,b,M)}return m},getAttrCellDataStr:function(e,t){var i="";return i=KD.format("data-field={0} data-rowId={1}",t||"",e||"")},cellEditor:function(t){var i=e('<input style="height:inherit;width:inherit;display:inline-block;">');return i},cellEditorParams:function(e){var t=e||{};return t},getColEditorOption:function(){return{}},getHeaderAttributes:function(){var t=void 0,i=this.config,r=KD.getValue(i,KD.KDVGridActionKeys.HeaderAlignment,void 0);return void 0!==r&&(t=t||{},e.extend(t,{style:"text-align:"+r+";"})),t},isCheckBox:function(){return!1},setSimplization:function(e,t){this.allowColumnFiltering=!1,this.allowGrouping=!1,this.allowSorting=e?!0:!1},setAllowColumnFiltering:function(e){this.allowColumnFiltering=e?!0:!1},isTreeExpander:function(){var e=this,t=e.getOwner();return t&&t.isTreeList&&e.isColDisabled()&&e.config.expandable},createHeaderTemplate:function(){var e=this,t=e.config.mustInput,i="",r=e.header.split("&"),o=e.headerText=r.length>0?r[r.length-1]||" ":" ";if(this.isLinkType()){var n,a={entrykey:e.owner?e.owner.key:"",key:e.dataIndex,row:-1,pageid:e.owner?e.owner.getPageId():""};a.itemid=a.pageid+"_"+a.entrykey+"_"+a.key+"_linkheader",a.attrname="currentclickdom",n="KD.vEntryLinkBtnClick('"+KD.stringify(a).replace(/\"/g,"&quot;")+"');",o='<span class="kd-grid-header-link" id="'+a.itemid+'" onclick="'+n+'">'+o+"</span>"}return e.isTreeExpander()?i='<span class="kd-treelistrow-lvlheader">'+o+"</span>":(i=o,1==t&&(i="<span>"+o+"</span><span class='kd-grid-mustinput'>*</span>")),0==this.allowSorting&&(i=KD.format('<span class="k-link"  tabindex="-1" style="">{0}</span>',i)),i},getLayoutSetting:function(e){var t={};try{for(var i=this,r=-1,o=-1,n=i.getVFieldName(),a=0;a<e.length;a++){var l=e[a].field;if(KD.equalsIgnoreCase(n,l)){r=e[a].width,o=a;break}}t.oi=i.colIndex,i.visible?(t.i=o,t.w=r):(t.i=9999,t.w=KD.isEmpty(i.width)?5:i.width),t.k=i.dataIndex}catch(s){KD.writeError("KDColumnDescriptor getLayoutSetting Exception:"+s),ret=null}return t}}),KDVColumnDescriptorFactory.registerType("kdvcol_default",KDVColumnDescriptor)}(jQuery),function(e){window.KDVColumnArraryStringDescriptor=KD.extend(KDVColumnDescriptor,{formatEditValue:function(e){var t={};return t=KD.isArray(e)&&e.length>0?{text:e[0],value:this.getOriginalCellValue(e)}:e},getOriginalCellValue:function(t){var i=t;return i?"string"==typeof i?i:e.isArray(i)?i.length>1?i[1]:i[0]:KD.isNumber(i)?i:void 0:""},getOriginalValue:function(e){var t="",i=this.getValue(e);return t=this.getOriginalCellValue(i)}}),KDVColumnDescriptorFactory.registerListType("arraytextfield",KDVColumnArraryStringDescriptor)}(jQuery),function(e){window.KDVColumnDateStringDescriptor=KD.extend(KDVColumnArraryStringDescriptor,{getColEditorOption:function(){return null}}),KDVColumnDescriptorFactory.registerListType("datefield",KDVColumnDateStringDescriptor),KDVColumnDescriptorFactory.registerListType("datetimefield",KDVColumnDateStringDescriptor)}(jQuery),function(e){window.KDVColumnNumberStringDescriptor=KD.extend(KDVColumnArraryStringDescriptor,{getColEditorOption:function(){return null}}),KDVColumnDescriptorFactory.registerListType("numberfield",KDVColumnNumberStringDescriptor)}(jQuery),function(e){window.KDVColumnImageBaseDescriptor=KD.extend(window.KDVColumnDescriptor,{getDefaultNoneImgSrc:function(){return"Content/themes/images/icon_picDefault.png"},getDefaultFileFilter:function(){return"*.jpg|*.png"},getFileServerDownUrl:function(e,t,i){var r=t,o=ClientAppProxy.Current.CTX.DBid,n=(new Date).valueOf(),a=KD.getUserToken();return""==r?r:(KD.isUrl(r)||""==r||(r=KD.getUrlRoot()+"/"+r),i&&(r+=t.indexOf("?")>=0?"&":"?",r+=KD.format("fileId={0}&dbId={1}&nail=1&t={2}&token={3}",e,o,n,a)),r)},getDisplayTemplate:function(e){e=e||{};var t=this,i=t.getOwner(),r=t.getGridStore(),o="min-height:"+r.rowHeight+"px;",n=e.disable,a=i.isViewGrid(),l=n&&!a?"k-gridCellstate-disabled":"",s=e?e.value||"":"",d={fcolor:e.forecolor,bcolor:e.backcolor};e.hiddenEnabled&&e.hiddenMask&&(fieldValue=e.hiddenMask);var c=e.tooltipIndicatorEnabled;KD.isEmpty(c)&&(c=!0);var u=e.tooltipEnabled?e.tooltip||s:"",g=u?' title="'+u+'"':"",f=u&&c?'<span class="kd-grid-tipflag"></span>':"",p=t.getIsRedBlue()||r.isRedBlue?t.redBlueCls||"":"";o+=KD.isEmpty(d.bcolor)?"":"background-color:"+KD.formatHtmlColor(d.bcolor)+";",o+=KD.isEmpty(d.fcolor)?"":"color:"+KD.formatHtmlColor(d.fcolor)+";";var h=KD.isEmpty(d.bcolor)?"":"kd-grid-cellspan-opacity",D=KD.format('<span class="{0} kd-grid-cellspan {1} {6}" style="{2};" {3}>{4}{5}</span>',p,l,o,g,s,f,h);return D}})}(jQuery),function(e){window.KDVPicBase64ColumnDescriptor=KD.extend(KDVColumnImageBaseDescriptor,{getColEditorOption:function(){return null},formatEditValue:function(e){var t;return t=KD.isArray(e)?{text:e[0],value:e[1]}:KDVPicBase64ColumnDescriptor.superclass.formatEditValue.call(this,e)},getDisplayValue:function(e,t,i){var r=this,o=r.getGridStore(),n={entrykey:i.gridKey,key:r.getFieldName(),row:t,pageid:r.getPageId()},a=r.getAttrCellDataStr(n.row,n.key),l=o.rowHeight;if(34>l){var s=r.getFormProxy();(s.dformConfig||s.config).isUseSmallScreenModel||(l=34)}var d="";KD.isEmpty(e)?e="":KD.isArray(e)?e=e[1]||e[0]||"":KD.isString(e)||(e=e.value||e.text||""),d=KD.isEmpty(e)?this.getDefaultNoneImgSrc():KD.isUrl(e)?e:KD.isBase64Str(e)?"data:image/jpeg;base64,"+e:KD.IsNullOrWhiteSpace(e)?this.getDefaultNoneImgSrc():KD.getUrlRoot()+"/"+e;var c="";return d&&(c=KD.format('<span style="text-align:center;height:{0}px;line-height:{0}px;" class="kd-grid-cellspan" {1} >',l,a)+KD.format("<img class='kd-grid-cellspan-image' onclick='KD.vEntryButtonClick({0});' src='{1}'/></span>",JSON.stringify(n),d)),c}}),KDVColumnDescriptorFactory.registerListType("kdpicfield",KDVPicBase64ColumnDescriptor)}(jQuery),function(e){window.KDVPicFileSvrColumnDescriptor=KD.extend(KDVColumnImageBaseDescriptor,{getColEditorOption:function(){return null},formatEditValue:function(e){var t;return t=KD.isArray(e)?{text:e[0],value:e[1]}:KDVPicFileSvrColumnDescriptor.superclass.formatEditValue.call(this,e)},getDisplayValue:function(e,t,i){var r=this,o=r.getGridStore(),n={entrykey:i.gridKey,key:r.getFieldName(),row:t,pageid:r.getPageId()},a=r.getAttrCellDataStr(n.row,n.key),l=o.rowHeight;if(34>l){var s=r.getFormProxy();(s.dformConfig||s.config).isUseSmallScreenModel||(l=34)}KD.isEmpty(e)?e="":KD.isArray(e)?e=e[1]||e[0]||"":KD.isString(e)||(e=e.value||e.text||"");var d=KD.urlDecodeComponent(e||""),c=KD.isUrl(d)?d:KD.IsNullOrWhiteSpace(d)?r.getDefaultNoneImgSrc():KD.getUrlRoot()+"/"+d,u=KD.format('<span style="text-align:center;height:{0}px;line-height:{0}px;" class="kd-grid-cellspan" {1} >',l,a)+KD.format("<img class='kd-grid-cellspan-image' onclick='KD.vEntryButtonClick({0});' src='{1}'/></span>",JSON.stringify(n),c);return u}}),KDVColumnDescriptorFactory.registerListType("kdpic2field",KDVPicFileSvrColumnDescriptor)}(jQuery),function(e){window.KDVUrlPictureColumnDescriptor=KD.extend(KDVColumnImageBaseDescriptor,{getColEditorOption:function(){return null},formatEditValue:function(e){var t;return t=KD.isArray(e)?{text:e[0],value:e[1]}:KDVUrlPictureColumnDescriptor.superclass.formatEditValue.call(this,e)},getDisplayValue:function(e,t,i){var r=this,o="",n=r.getGridStore();KD.isEmpty(e)?e="":KD.isArray(e)?e=e[1]||e[0]||"":KD.isString(e)||(e=e.value||e.text||"");var a=KD.urlDecodeComponent(e||""),l=this.exDownloadUrl?!0:!1,s=n.rowHeight;o=l?this.getFileServerDownUrl(a,this.exDownloadUrl,!0):KD.IsNullOrWhiteSpace(a)?this.getDefaultNoneImgSrc():KD.isBase64Str(a)?KD.format("data:image/jpeg;base64,{0}",a):KD.isUrl(a)?a:KD.format("{0}/{1}",KD.getUrlRoot(),a);var d={entrykey:r.owner.key,key:r.getFieldName(),row:t,pageid:r.owner.getPageId()},c="<img class='kd-grid-cellspan-image' style='display:inline-block;max-height:{0}px;margin:.3em auto 0em;' src='{1}' {2}/>",u=KD.format("onclick='KD.vEntryButtonClick({0});'",JSON.stringify(d)),g=KD.format(c,s,o,u);return g},getSchemaModel:function(){var e=KDVUrlPictureColumnDescriptor.superclass.getSchemaModel.call(this);return e.editable=!1,e},getCellEditorTemplate:function(e,t){return'<div style="text-align: center;"></div>'},initCellEditor:function(e,t){},createTemplate:function(e){var t=this,i=t.getGridStore(),r=e&&e.backcolor,o=e&&e.forecolor,n=e&&e.disable,a="min-height:"+i.rowHeight+"px;";if(n)return KDUrlPictureColumnDescriptor.superclass.createTemplate.call(this,e);var l=e.field,s=t.getOwner(),d=e.rowData,c=d.rowId,u=t.getAttrCellDataStr(c,l),g=i.getRowDataByServerRowId.call(i,c);if(void 0===g)return"";t.isTreeExpander()&&(a+="display: inline;",r="");var f=s.isViewGrid(),p=n&&!f?"k-gridCellstate-disabled":"",h="",D=t.getIsRedBlue()?t.redBlueCls||"":"",y=void 0!=g?t.getValueByRowData(g,l):"";if(~(this.allowHtmlCell?y:KD.htmlUtil.encode(y)).search(/\r\n|\n/g)&&(a+="line-height:"+i.rowHeight/2+"px;"),r){var v=v=o?"color:"+o+";":"color:#000000;";(void 0==n||0==n)&&(v="",r=""),h='<div class="'+D+" kd-grid-celldiv "+p+'" style="background-color:'+r+"; text-align:"+t.getTextAlign()+";"+a+v+'"><span class="kd-grid-cellspan" '+u+' style="'+a+'"></span></div>'}else{var v=o?"color:"+o+";":"";h='<span class="'+D+" kd-grid-cellspan "+p+u+'" style="'+a+v+"; text-align:"+t.getTextAlign()+';"></span>'}return h},getAttributesClass:function(){var e=KDVUrlPictureColumnDescriptor.superclass.getAttributesClass.call(this)+" kd-grid-image-container";return e},showDownPictureClick:function(t,i){if(KD.isEmpty(t))return t;var r=e(t);i.isdown=!0;var o='<div class="KDImageEditIconContainer-down"><span id="{0}_down"  alt="down" title="{1}" class="kd-grid-KDImageEditIcon-down" style="background-image:url({3});" {2}></span></div>',n=KD.format("onclick='KD.vEntryPictureFileClick({0});'",JSON.stringify(i)),a=e(KD.format(o,i.id,ResManager.LoadKDString("下载","014005030037576"),n,KD.getImageUrlByNameAndVersion("kd_icon_extend.png")));return r.find(".kd-grid-cellspan-image").after(a),r[0].outerHTML},_PictureFileClickCallback:function(e,t){e!=KDMessageBox.KDDialogResult.Ok&&e!=KDMessageBox.KDDialogResult.Yes||!this.PictureFileClick||(t.isdeletefile=!0,this.PictureFileClick(t))},PictureFileClick:function(t){if(t.isclear){if(t.isdeletefile)this.setValue(t.row,""),e("#"+t.id+"_c").attr("src",this.getDefaultNoneImgSrc()),this.owner.el.find("#"+t.id+"_file").val("");else if(!KD.isEmpty(this.getValue(t.row))){var i={name:ResManager.LoadKDString("金蝶提示","099002000000002"),msg:ResManager.LoadKDString("确定删除吗?","0991733000005634"),type:KDMessageBox.KDMesBoxType.Question,button:KDMessageBox.KDMessageBoxButtons.OkCancel,callback:this._PictureFileClickCallback,callbackentity:this,args:t};KDMessageBox.show(i)}}else if(t.isdown){var r=this.getFormProxy();if(!KD.isEmpty(r)&&!KD.isEmpty(t.row)&&t.key){var o={};o.row=t.row,r.fireCustomEventsNoData(t.key,"Kingdee.BOS.ImageDownload",KD.stringify(o))}}else{var n=this.editor.exExtandUrl;""==n||KD.isUrl(n)||(n=KD.getUrlRoot()+"/"+n);var a=!0;if(""==n&&(a=!1),t.ispicview){var l=this.getValue(t.row);return void(l&&""!=l&&a&&KD.vEntryButtonClick({entrykey:t.entrykey,key:t.key,row:t.row,pageid:t.pageid}))}var s=t.id+"_file",d=this.celleditorMap[t.id];d||(this.celleditorMap[t.id]=!0,t.url=n,t.isfileserver=a,t.auto=a,t.exDownloadUrl=this.editor.exDownloadUrl,this.intiUploadloader(t)),e("#"+s).click()}},intiUploadloader:function(t){var i=this;return new KDFileUpLoader({baseid:t.id,fileInputButton:e("#"+t.id+"_file"),fileTypeExts:i.fileFilter,datarow:t.row,itemTemplate:"",url:t.url,exDownloadUrl:t.exDownloadUrl,maxFileLength:0,auto:t.auto,isfileserver:t.isfileserver,multi:!1,onBeforeSelectFile:function(e){return"undefined"==typeof FileReader?(alert(ResManager.LoadKDString("抱歉，您的浏览器不支持 FileReader，请使用现代浏览器操作！","099002000000056")),!1):!0},onUploadError:function(e,t,r){var o=i.getFormProxy();null!=o?o.showErrMsgStr(r):KD.Error.raise({msg:r})},onFileItemsChanged:function(e){var t=e.option.isfileserver;if(e.files&&e.files.length>0&&!t){var r=new FileReader;r.readAsDataURL(e.files[0]),r.onload=function(e){i.setValue(e.option.datarow,this.result.substr(this.result.indexOf(",")+1))}}},onFileStateChanged:function(t){var r=t.option.isfileserver;if(r){var o=t.target.fileState;if(t.state==o.Uploaded&&t.uploadedfiles&&t.uploadedfiles.length>0){i.setValue(t.option.datarow,t.uploadedfiles[0].ServerFileName);var n=i.getFileServerDownUrl(t.uploadedfiles[0].ServerFileName,t.option.exDownloadUrl,r);e("#"+t.option.baseid+"_c").attr("src",n)}}}})}}),KDVColumnDescriptorFactory.registerListType("kdurlpicfield",KDVUrlPictureColumnDescriptor),KDVColumnDescriptorFactory.registerType("kdpicture",KDVUrlPictureColumnDescriptor)}(jQuery),function(e){window.KDVLinkButtonColumnDescriptor=KD.extend(window.KDVColumnDescriptor,{getColEditorOption:function(){var e=new KDTextFieldProxy,t=e.getGirdEditorOptions(this.editor);return delete t.formatter,t},getSplitPatternStyleClass:function(e){e=e||0;var t="";switch(e){case 0:t="kd-linkbutton-splitStyle-horizontal"}return t},getDisplayTemplate:function(e){var t=this,i="",r=(e||{}).value;if(KD.isEmpty(r))return i;var o=(t.getGridStore(),e.rowData),n=(t.converFieldName(e.field),e.attrCellDataStr||""),a={fcolor:e.forecolor,bcolor:e.backcolor},l=JSON.stringify({entrykey:o.gridKey,key:t.dataIndex,row:e.rowId,pageid:t.getPageId()}),s=e&&e.disable,d=t.getOwner(),c=d.isViewGrid(),u=KD.isEmpty(a.bcolor)?"":"kd-grid-cellspan-opacity",g=ClientAppProxy.Current.IsIgnoreGridCellColorTrans&&u?"kd-grid-celldiv-ignorecellopcity":"",f=s&&!c?"k-gridCellstate-disabled":"",p=KD.isEmpty(a.bcolor)?"":"background-color:"+a.bcolor+";";p+="color:"+(KD.isEmpty(a.fcolor)?"":a.fcolor)+";",p+="height:100%";var h="",D=t.config.splitPattern;if(KD.isEmpty(D))h=KD.format("<a target='_blank' style='max-width:100%;display:inline-block;' onclick='KD.vEntryButtonClick({0});' class='type-link kd-text-ellipsis'>{1}</a></span>",l,e.value);else for(var y=r.split(D.splitChar),v=t.getSplitPatternStyleClass(D.splitStyle),w=0;w<y.length;w++){var m=KD.cloneObject(l),K=KD.stringify({clickChildIndex:w});h+=KD.format("<a target='_blank' style='max-width:100%;display:inline-block;' onclick='KD.vEntryButtonClick({0},{1});' class='type-link kd-text-ellipsis {3}'>{2}</a>",KD.stringify(m),K,y[w],v)}var C=KD.format('<span class="kd-grid-cellspan kd-grid-linktd {0} {1} {2}" {3} style="{4}">{5}</span>',f,u,g,n,p,h);return d.isEditable()&&!s&&(C=KD.format('<span class="kd-grid-cellspan kd-grid-linktd {0} {1} {2}" style="{3}">{4}</span>',f,u,g,p,e.value)),e.readonly&&(C=kendo.format('<span class="kd-grid-cellspan kd-grid-linktd" style="color:#212121">{0}</span>',e.value)),C}}),KDVColumnDescriptorFactory.registerType("kdlinkbutton",KDVLinkButtonColumnDescriptor)}(jQuery),function(e){window.KDVButtonColumnDescriptor=KD.extend(window.KDVLinkButtonColumnDescriptor,{getDisplayTemplate:function(e){var t=this,i="",r=(e||{}).value;if(KD.isEmpty(r))return i;var o=(t.getGridStore(),e.rowData),n=(t.converFieldName(e.field),JSON.stringify({entrykey:o.gridKey,key:t.dataIndex,row:e.rowId,pageid:t.getPageId()})),a="<span class='kd-grid-cellspan' ><button type='button' class='k-button' style='margin-top:3px;width:100%;' onclick='KD.vEntryButtonClick({arg});'>{text}</button></span>";return i=a.replace(/\{arg\}/,n).replace(/\{text\}/,r)}}),KDVColumnDescriptorFactory.registerType("kdbutton",KDVButtonColumnDescriptor)}(jQuery),function(e){var t=34,i=window.KDVGridProxy;e.extend(i.prototype,{isGrid:!0,headerSplitChar:"&",toolbarHeight:t,rowHeight:t,pagerHeight:38,isInit:!1,refreshDataActions:!1,lastNavigateTD:null,lastFocusTD:{},localConfiguration:{},AllowBlockPaste:!1,isInColSelection:!1,columnOrderForExit:[],serverFilterString:[],newRowEvent:{PostDataOnly:!0},checkRowId:function(e){return void 0===e?-1:e},loadConfig:function(e){var i=this;i.config=KD.cloneObject(e),i.serverFilterString=[],i.isInVertical=KDFlowlayoutProxy.isInVertical(i.config),i.rowHeight=KD.getValue(e,"rowHeight",t);var r=i.getFormProxy();(r.dformConfig||r.config).isUseSmallScreenModel&&(i.isViewGrid()?i.el.addClass("kd-grid-view-smallmodel"):i.el.addClass("kd-grid-editor-smallmodel")),KDVGridProxy.superclass.loadConfig.call(this,e),i.AllowBlockPaste=KD.getValue(e,"AllowBlockPaste",i.AllowBlockPaste),i.setRequestLock(!0),i.selOp=KDVGridSelOpStrategy.getOpStratege(i),i.invokeSelOp("initConfigSelected",e);KD.isFunction(r?r.getPageId:"")?r.getPageId.call(r):null;KD.delayInvoke(function(){ClientAppProxy.fireUserBehavior(null,"HTML5","KDVGrid","云星空金蝶V表格")},8e3)},createControl:function(t){var i=this;KDVGridUtils.loadKDVGridResource(ClientAppProxy.Current.defaultLocalId);try{KDVGridProxy.superclass.createControl.call(i,t),i.el.css({display:"flex",flexDirection:"column",flexGrow:1}),i.toolbar=e("<div class='kd-vgrid-toolbar' >").appendTo(i.el),i.gridPanel=e("<div class='kd-vgrid-gridpanel' >").appendTo(i.el),i.pagerCt=e("<div class='kd-vgrid-pagerbar' >"),i.statebar=e("<div class='kd-vgrid-statebar' >").appendTo(i.el)}catch(r){KD.writeLog(r.message,(r.stack||"").substr(0,200),!0)}return i.el},isDontLazy:function(){return this.rendered&&this.activated},initComponent:function(){var e=this;KDVGridProxy.superclass.initComponent.call(e),e.createColumnsAndStore(e.config)},initToolbar:function(){var e=this,t=e.config;if(t.tbar){t.tbar.entryKey=e.getKey(),t.tbar.actionKey="EntryBarItemClick",t.tbar.id=e.key+"_ENTRYBAR",t.tbar.dock=KD.dock.Top,t.tbar.height=e.toolbarHeight,t.tbar.parent=e.config.id;var i=e.getControlFactoryProxy(),r=e.tbarPxy=i.createControl.call(i,t.tbar);r.loadConfig.call(r,t.tbar),e.isFlowEditGrid()&&KDFlowlayoutProxy.isInVertical(e.config)&&r.el.addClass("kd-grid-toolbar-bizflow"),e.toolbar.append(r.el)}},initGrid:function(t){var i=this;i.initToolbar(),i.vgrid||(i.gridPanel.empty(),i.vgrid=e("<div>").appendTo(i.gridPanel)),i.doLayout.call(i),i.vGridIns=i.vgrid.KDVGrid(t),i.attachGridEvents()},attachGridEvents:function(){var e=this,t=".kd-v-grid-root div .kd-btn-desensitize-container",i="click.kdvgridproxy";e.el.undelegate(t,i).delegate(t,i,function(t){e.onMkButtonClick.call(e,t)})},detachGridEvents:function(){var e=this,t=".kd-v-grid-root div .kd-btn-desensitize-container",i="click.kdvgridproxy";e.el.undelegate(t,i)},release:function(){var e=this;try{e.detachGridEvents.call(e),e.selTipsEl&&delete e.selTipsEl;var t=e.getVGridApi();t&&KD.isFunction(t.destroy)&&t.destroy(),KDVGridProxy.superclass.release.call(e)}catch(i){KD.writeLog(i.message,(i.stack||"").substr(0,200),!0)}},getVGridOptions:function(){var t=this,i=t.isMultiSelectMode(),r=t.store.getVOptions();return r=e.extend(r,{rowClickAsAppendSelect:t.isSelectClickAsAppend()}),r=e.extend(r,t.getVGridEventOptions()),i||(e.extend(r.defaultColDef,{headerCheckboxSelection:!1,checkboxSelection:!1}),r=e.extend(r,{rowSelection:"single",checkboxSelection:!1})),r},getVGridEventOptions:function(e){var t=this,i={onRowSelected:function(e){t.onRowSelected.call(t,e)},onSelectionChanged:function(e){t.onSelectionChanged.call(t,e)},onRowDoubleClicked:function(e){t.onRowDoubleClicked.call(t,e)},onRowDataChanged:function(e){t.onRowDataChanged.call(t,e)},onMouseOver:function(e){t.onMouseOver.call(t,e)}};return i},getStore:function(){return this.store},createNewStore:function(){var t=this;return e.extend(new KDVDataStore,{rows:[],rowHeight:t.rowHeight,virtualScroll:!t.config.isRealModel,isFlowViewList:t.isFlowViewList(),isFlowEditGrid:t.isFlowEditGrid()})},createColumnsAndStore:function(e){var t=this;t.clearGridStates(),e.columns=e.columns||[];var i=t.checkGridColumnKeys(e.columns);i.length<e.columns.length&&(e.columns=i),null==t.store?t.store=t.createNewStore():t.store.clearData.call(t.store);var r=t.store;r.setOwner(t),r.loadConfig(e),r.createColumnModel(e.columns);var o=t.getVGridOptions();t.initGrid(o)},checkGridColumnKeys:function(e){for(var t=this,i=[],r=[],o="",n=0;n<e.length;n++){var a=e[n],l=!0,s=a.dataIndex,d=a.header;try{KD.isEmpty(s)?l=!1:new Function("obj."+s)}catch(c){var u=r.length>0&&r.length%6==0;r.push(KD.format("{0}[ {1} : {2} ] ",u?"\r\n":"",d,s)),KD.writeLog("Invalid characters exist in the field name!","",!0),l=!1}l&&i.push(a)}if(o=r.join(","),!KD.isEmpty(o)){var g=t.getFormProxy(),f=ResManager.LoadKDString("字段键值建议使用常用字符，不要使用纯数字或特殊字符，当前存在不符合要求的字段键值，建议按要求调整正确，再使用该功能。\r\n异常字段键值如下：{0}","0141072000004555"),p=KD.format(f,o);g&&g.showErrMsgStr.call(g,p)}return i},clearGridStates:function(e){var t=this;e&&(t.revertGridServerStates(),t.invokeSelOp("initDataSelected",e))},isFlowViewList:function(){return this.isViewGrid()&&(KDFlowlayoutProxy.isInVertical(this.config)||KDFlowlayoutProxy.isInColumn(this.config))},isFlowEditGrid:function(){return this.isEditable()&&KDFlowlayoutProxy.isFlowlayoutChild(this.config)},getFlowViewListHeight:function(){return"auto"},getFlowEditGridHeight:function(){return"auto"},showBlock:function(e){},hideBlock:function(e){},getInnerMaxRow:function(e){var t=KDVGridProxy.C_ListMaxPageCount;return KD["debugger"](KD.format("maxRow is {0}, but HTML5 cann't support! change to {1} max row",e,t),e>t),e&&t>e?e:t},isWillMerge:function(){return KD.getValue(this.config,"willMerge",!1)},isSelColEnable:function(){return this.config&&!!this.config.enableSelCol||this.isViewGrid()&&this.config.IsListMultiSel},setGridSelectedType:function(e){var t=e.SetGridSelectedType||KD.GridSelectedType.SingleRow;switch(t){case KD.GridSelectedType.SingleRow:this.IsListMultiSel=!1;break;case KD.GridSelectedType.MultiRow:this.IsListMultiSel=!0;break;case KD.GridSelectedType.Cell:}this.setIsListMultiSel(this.IsListMultiSel)},setGridOptions:function(e,t){try{}catch(i){KD.writeError(i)}},setIsListMultiSel:function(e){if(void 0!==e&&e!=this.config.IsListMultiSel){this.config.IsListMultiSel=e,this.invokeSelOp("initConfigSelected",this.config);var t=this.getUIFocusedCellData();t&&this.invokeSelOp("initDataSelected",{focusrowindex:t.rowId,selRows:t.rowId+""})}},isMultiSelectMode:function(){var e=!1,t=this,i=t.config,r=void 0===i.IsListMultiSel?!t.isEditable():i.IsListMultiSel;return e=t.isViewGrid()?t.isSelColEnable()&&r:r},isSingleSelectMode:function(){return!this.isMultiSelectMode()},isViewGrid:function(){return this.config&&"VIEWGRID"==this.config.gridtype},isEditable:function(){var e=this.isViewGrid();return e?!e:KD.getValue(this.config,"editable",!0)},createDyanmicList:function(e,t){var i=this;this.setFrozen({isInit:!0}),i.isViewGrid()?(this.isInit=!0,KD.delayInvoke(function(){i.createDyanmicListCore.call(i,e,t)})):i.createDyanmicListCore(e,t)},createDyanmicListCore:function(t,i){if(this.isInit=!0,!KD.isEmpty(KD.getValue(this.config,"groupColumnsInfo",void 0))&&KD.isEmpty(KD.getValue(t,"groupColumnsInfo",void 0))&&(this.config.groupColumnsInfo=[]),this.config.primaryKey&&t.primaryKey&&this.config.primaryKey!==t.primaryKey&&(t.primaryKey=this.config.primaryKey),e.extend(this.config,t),this.createColumnsAndStore(this.config),this.isVisible()&&this.el.show(),this.showBlock(),void 0===this.firstLoad||this.firstLoad){this.startRow=t.startRow?t.startRow:0;var r=t.pageSize;this.pageSize=this.getInnerMaxRow(r)||20}else this.pageSize&&(this.config.pageSize=this.pageSize);this.firstLoad=!1,this.isInit=!1,this.setDataUrl(i),this.doLayout()},setDataUrl:function(e){this.dataUrl=e,this.refreshData(this.startRow,this.pageSize)},refreshData:function(e,t,i){if(void 0!=e&&(0>e&&(e=i?-1:0),this.dataUrl&&this.dataUrl.length>0)){var r='&paramdata=["'+this.getKey()+'",'+e+","+t+",null]",o=this.dataUrl+r,n=new KDRequest;n.scope=this,n.url=o,n.callback=this.onResponse,n.errCallBack=this.onResponseError,this.getFormProxy().setBusy(!0),n.callByUrl()}},loadStoreData:function(e){this.setData(e),this.initDisp(e),this.initPagerData(e)},setRefreshGridDataFlag:function(e){this.refreshDataActions=void 0===this.refreshDataActions?e:this.refreshDataActions||e,this.refreshGridData()},setData:function(e){var t=this;t.disableActions&&(t.updateFieldStates(this.disableActions),delete this.disableActions),t.clearGridStates(e),(e||{}).simpleAllCols,t.store.setData.call(t.store,e,function(e){t.setRefreshGridDataFlag(!0)}),this.initPagerData(e),this.hideBlock()},updateRowDatas:function(e){var t=this,i=this.getStore();i.updateRowDatas.call(i,e),i.setUpdateView.call(i,!0),t.setRefreshGridDataFlag(!0)},initDisp:function(t){var i=t.format,r=this.getStore();if(KD.isArray(i))for(var o in i)if(KD.isRunInForIn(o,i)){var n=i[o],a={};KD.KDVGridActionKeys.Forecolor in n&&(e.extend(a,{key:KD.KDVGridActionKeys.Forecolor}),a[KD.KDVGridActionKeys.Forecolor]=n[KD.KDVGridActionKeys.Forecolor]),KD.KDVGridActionKeys.Backcolor in n&&(e.extend(a,{key:KD.KDVGridActionKeys.Backcolor}),a[KD.KDVGridActionKeys.Backcolor]=n[KD.KDVGridActionKeys.Backcolor]);var l=parseInt(n.row),s=r.getRowDataByServerRowId.call(r,l),d=void 0!==n.col?r.getColumnDescriptor.call(r,n.col):r.getColumnDescriptor.call(r,r.serverIndexFieldName);void 0===d&&n.col?KD.writeLog("initDisp:: column ["+n.col+"] not found!"," formt item:"+KD.stringify(n),!0):KD.KDVGridCellStateHandler.doHandler(this,d,s,a,this.afterUpdateFieldState)}t.viceTitle||""},refreshGridData:function(){var e=this;e.store&&(e.store&&e.store.rows&&e.store.rows.length>200&&e.showBlock(),KD.delayInvoke(function(){e.refreshDataActions&&!e.isInit?(delete e.refreshDataActions,e.onRefreshGridData.call(e),e.hideBlock()):this.refreshDataActions||e.hideBlock()}))},onRefreshGridData:function(){var e=this;e.getStore();try{var t=e.getVGridOptions();e.initGrid(t)}catch(i){KD.writeError(i)}finally{e.clearUpdateGridViewStatus.call(e),e.onAfterRefreshGridData(),KD.writeLogTime(e.getKey()+".onRefreshGridData() End  :",e.getBaseId(),!0)}},onAfterRefreshGridData:function(){var e=this,t=e.getStore(),i=e.invokeSelOp.call(e,"isDefSelected",!1),r=e.invokeSelOp.call(e,"isFirstLoad",!1);if(i&&r){var o={field:"",isSel:!0,rowId:t.getCurrentRowId.call(t)};o.rowId?KD.isEmpty(o)||e.invokeSelOp.call(e,"fireRowChanged",o):e.invokeSelOp.call(e,"svrCmdSelectedChanged","current"),e.invokeSelOp.call(e,"resetFirstLoad")}else e.invokeSelOp.call(e,"svrCmdSelectedChanged","current")},clearUpdateGridViewStatus:function(){var e=this,t=e.getStore();delete e.colValueChanged,delete e.cellChanges,e.updateGridView=!1,t&&t.setUpdateView.call(t,!1)},setFieldstates:function(e){try{this.isVisible()&&this.el.show(),this.updateFieldStates(e)}catch(t){KD.writeError(t)||KD.Error.raise({sourceClass:"KDVGridProxy",sourceMethod:"setFieldstates",name:ResManager.LoadKDString("字段属性设置错误","0991733000003934"),msg:t.message+"<p>"+t.stack+"<p>"+KD.obj2str(e)})}},getFieldKeys:function(){var t=this,i=[];return e.each(t.getVGridOptions().columns,function(t,r){r.columns&&r.columns.length>0?e.each(r.columns,function(e,t){t.field&&""!=t.field&&i.push(t.field)}):r.field&&""!=r.field&&i.push(r.field);
}),i},updateFieldStates:function(e,t){var i=this,r=i.getStore(),o=!1;if(i.isInit&&!t){var n={para:e,isSkipInit:!0};return void KD.delayInvoke(function(e){e=e||{};var t=e.para,r=e.isSkipInit;i.updateFieldStates.call(i,t,r)},void 0,void 0,n)}i.needDoLayout=!1;try{if(i.isInit=!0,KD.isArray(e)){var a=i.isBulkUpdating=function(e,t){var i=0;for(var r in e)if(KD.isRunInForIn(r,e)&&(void 0!==e[r].value||void 0!==e[r].disabled)&&(i++,i>t))return!0;return 0==i?void 0:!1}(e,i.bulkCellChangeLimitGate);for(var l in e)if(KD.isRunInForIn(l,e)){var s=e[l],d=s.key;d?i.updateFieldState.call(i,s,t):(r.setStates.call(r,null,null,s),KD.KDGridCellStateHandler.doHandler(i,null,null,s,i.afterUpdateFieldState))}o=!(i.isBulkUpdating||r.updateView),delete this.isBulkUpdating}else i.updateFieldState.call(i,e,t)}catch(c){KD.writeError(c)}finally{i.isInit=!1,i.updateGridView=!0}var u=!1;(a||!i.isEditable()||this.isViewGrid()||r.updateView)&&(u=!0),i.needDoLayout&&(i.isShowRecords=!1,this.doLayout.call(this,isforceDolayout),i.needDoLayout=!1),u?(i.setToRefreshGridView.call(i,{msg:"isUpdateGridView = true"}),i.onGridDataRefreshReady({isBulkUpdating:!1})):(i.refreshBatchUpdateDataActions=!0,i.batchUpdateGrid.call(i))},updateFieldState:function(e,t){var i=this,r=i.getStore(),o=e,n=o.key;if(n){var a=null,l=o.row;if(-1!=l&&void 0!=l&&(a=r.getRowDataByServerRowId.call(r,l),l>0&&KD.isEmpty(a)))return void KD.writeLog(KD.format("updateFieldStates:{0},rowId:{1} is not found",this.key,l),"",!0);var s=r.getColumnDescriptor.call(r,n);if(s)r.setStates.call(r,s,a,o),KD.KDVGridCellStateHandler.doHandler(i,s,a,o,i.afterUpdateFieldState);else{if(o.disabled)return;var d=r.getColumnDescriptorsParent.call(r,n);if(!d||d.length<=0)return;for(var c in d)KD.isRunInForIn(c,d)&&(s=d[c],r.setStates.call(r,s,a,o),KD.KDVGridCellStateHandler.doHandler(i,s,a,o,i.afterUpdateFieldState))}}},isMergeGrid:function(){try{var t=this,i=!1,r=t.config&&t.config.columns;return r&&r.length>0&&e.each(r,function(e,r){if(KD.isEmpty(r.visible)||!KD.isEmpty(r.visible)&&r.visible){var o=r&&r.header;if(!KD.isEmpty(o)&&o.indexOf(t.headerSplitChar)>-1)return void(i=!0)}}),i}catch(o){return KD.writeLog(KD.format("KDVGridProxy isMergeGrid Error:{0}",o.message),"",!0),!1}},doActions:function(e){var t=this.getFormProxy();t&&t.doActions.call(t,e)},fireEntityRowClick:function(e){var t=this;if(t.invokeSelOp("fireRowChanged",e),t.pagerPxy&&t.pagerPxy.setCurrSelectNumber){var i=t.invokeSelOp.call(t,"getSelectedRows"),r=i.length;t.pagerPxy.setCurrSelectNumber(r,e.field)}},getColumnDataIndex:function(e){var t=this,i=e,r=t.store,o=r.getColumnDescriptor.call(r,e);return o&&(i=o.getFieldName.call(o)),i},isClientNewRow:function(e){var t=this,i=!1,r=t.getUIFocusedCellData().rowId;return i=t.store.isClientNewRow.call(t.store,e,r)},getUIFocusedCellData:function(){var t=this,i={rowId:-1,field:"",isSel:!1},r=i,o=t.getVGridApi();try{var n=o.getFocusedCell()||{},a=o.getSelFieldName(),l=KD.equalsIgnoreCase(a,n.field)?KDStore.C_SelColKey:t.getColumnDataIndex(n.field),s=!!KD.equalsIgnoreCase("G",KD.format("{0}",n.rowId).substr(0,1));e.extend(r,{field:l,rowId:s?"-1":n.rowId,isSel:n.isSelected})}catch(d){r=i,KD.writeLog(d.message,(d.stack||"").substr(0,200),!0)}return r},getFirstVisColName:function(){var e=this,t="",i=e.getVisibleCols();return!KD.isEmpty(i)&&i[0]&&KD.isFunction(i[0].getFieldName)&&(t=i[0].getFieldName.call(i[0])),t},getVisibleCols:function(){var e=this,t=e.store,i=e.isEnableColPager(),r=[];if(t){var o=t.getVisibleCols.call(t);if(o&&o.length>0)if(i)r=e.getCurColPageCols();else for(var n=0;n<o.length;n++)o[n]&&r.push(o[n])}return r},getSelection:function(t,i){var r=this,o=r.getStore(),n=[],a={entryKey:r.getKey(),colName:"",rowIndex:r.isViewGrid()?0:-1,selRows:"",isClientNewRow:!1,clientNewRows:""},l=r.getUIFocusedCellData();if(t||(t=l.field||r.lastFocusTD&&r.lastFocusTD.field||r.getFirstVisColName()||""),e.extend(a,{colName:t?r.getColumnDataIndex(t):""}),!o)return a;if(n=r.invokeSelOp("getSelectedRowIdArray"),!KD.IsNullOrWhiteSpace(t)&&r.newRowEvent[i]&&r.isClientNewRow(a.colName)){var s=r.store.getNewRowId.call(r.store);e.extend(a,{isClientNewRow:!1,clientNewRows:(s||"")+""})}var d=o.getRowCount.call(o);return n.length>0&&e.extend(a,{rowIndex:0==d?-1:l.rowId||n[0],selRows:0==d?"":n.join(",")}),a},getVGridApi:function(){var e=this,t=e.vGridIns;return t},refreshFirstPageData:function(){var e=this;e.refreshData.call(e,0,e.pageSize)},onResponseError:function(){this.getFormProxy().setBusy(!1)},onResponse:function(e){this.isVisible()&&this.el.show();var t=e,i=(this.LoadStoreData,KD.isString(t)?KD.parseObject(t):t);if(i){if(i.isFailureQuery){var r=this.getFormProxy();r.showMessage.call(r,i.msg?i.msg:"Grid onResponse error!","",this.config.id,0,3)}else this.initPagerData(i),KD.isArray(i)?this.doActions(i):this.loadStoreData(i);this.getFormProxy().setBusy(!1)}}}),KDControlFactoryProxy.registerType("kdvgrid",KDVGridProxy)}(jQuery),function(e){e.extend(KDVGridProxy.prototype,{setAllowDefaultSelected:function(e){this.invokeSelOp("isDefSelected",e)},getSelectedIds:function(){var e=this,t=e.getVGridApi();if(t){var i=t.getSelectedNodes();return i}},addCellChange:function(e,t){},setToRefreshGridView:function(e){var t=this;t.setRefreshGridDataFlag.call(t,!0),KD.writeLog("setToRefreshGridView",KD.toString(e||{}),!0)},batchUpdateCell:function(e){},batchUpdateGrid:function(){},onGridDataRefreshReady:function(e,t){},setSummaryData:function(e){var t=this,i=t.getVGridApi(),r=t.getStore();r.setSummaryData.call(r,e),i&&KD.isFunction(i.setSummaryData)&&i.setSummaryData(r.sumData)},selectRows:function(e,t){if(KD.isArray(e)&&e.length>0){var i=e.join(",");this.pagerPxy&&this.pagerPxy.setCurrSelectNumber(e.length),this.invokeSelOp.call(this,"svrCmdSelectedChanged",i,t)}},setSelectRowsTips:function(e){if(!KD.isArray(e))return void(t.selTips="");var t=this,i=e,r="";for(var o in i)if(KD.isRunInForIn(o,i)){var n=i[o];n&&n.Caption&&n.Value&&(r+='<div class="kd-grid-seltipitem"><span class="kd-grid-seltips-caption">'+n.Caption+'</span><span class="kd-grid-seltips-value">'+n.Value+";</span></div>")}t.selTips=r},setColIgnoreDisableReset:function(e){this.isIgnoreLocalColReset=e},isSelectClickAsAppend:function(){var e=this,t=!1,i=KD.getLocalConfiguration()||{},r=i.DisabledColReset||!1,o=e.isIgnoreLocalColReset||!1;return t=o?!1:r},isHeadFilterLinkage:function(){var e=!1,t=KD.getLocalConfiguration()||{};return e=1==t.GridHeadFilterOnlyShowVisData||KD.equalsIgnoreCase(t.GridHeadFilterOnlyShowVisData+"","true")},setFrozen:function(e){var t=this,i=t.getStore(),r=e||{};i&&i.setFrozenObj&&(i.setFrozenObj.call(i,e),i.resetVisibleCols(),r.isInit||i.setUpdateView.call(i,!0))},SimplizationColumns:function(e){this.simplizationColumns(e)},simplizationColumns:function(e){var t=this,i=t.getStore(),r=e;if(!KD.isEmpty(r))for(var o in r)if(KD.isRunInForIn(o,r)){var n=r[o]+"",a=i.getColumnDescriptor.call(i,n);a&&(t.config&&t.config.showFilterRow?a.setSimplization.call(a,!1,t.config.showFilterRow):a.setSimplization.call(a))}},simplizationAllColumns:function(){var e=this,t=e.getStore(),i=t.getColumnDescriptors.call(t);for(var r in i)if(KD.isRunInForIn(r,i)){var o=i[r];o&&o.setSimplization.call(o)}e.setAllowSorting(!1)},setAllowSorting:function(e){this.config.allowSorting=e},fireSortEvents:function(e){var t=this,i=t.getKey(),r=t.getVGridApi(),o=t.getFormProxy();if(r){for(var n=[],a=r.getSortType(),l=a.fieldSeq||[],s=0;s<l.length;s++){var d=l[s],c=a[d],u=c;if(u){var g={fieldName:d,sortOrder:u};n.push(g)}}var f=KD.stringify({SortInfo:n});o&&o.fireCustomEventsNoData.call(o,i,"SortChanged",f);for(var p={},s=0;s<n.length;s++){var h=n[s];p[h.fieldName]=h.sortOrder}t.sortColumnsInner({SortColumns:p})}},sortColumns:function(e){this.sortColumnsInner(e,!0)},sortColumnsInner:function(e,t){var i=this,r=e,o=i.getStore(),n=KD.getValue(r,"SortColumns",{});if(!KD.isEmpty(n)){if(!o.isMultiSort){var a=o.getColumnDescriptors.call(o);if(a)for(var l in a)if(KD.isRunInForIn(l,a)){var s=a[l];s&&s.setSort.call(s,"",t)}}for(var d in n)if(KD.isRunInForIn(d,n)){var c=o.getColumnDescriptor.call(o,(d||"").toUpperCase());if(c){var u=KD.isString(n[d])?n[d]:n[d]-1;if(c.setSort.call(c,u,t),!o.isMultiSort)break}}t&&(o.setUpdateView.call(o,!0),i.setRefreshGridDataFlag(!0))}},setFilterString:function(e){var t=this,i=t.serverFilterString=t.serverFilterString||[];i.push(e),t.setFilterStringInner(e,!0)},setFilterStringInner:function(e,t,i){var r=this;if(!KD.isEmpty(e)){var o=r.getStore(),n={};if(t){var a="=",l=" in ",s=[],d="",c="";if(e.indexOf(l)>=0){var u=e.split(l);u.length>1&&(d=(u[0]+"").trim(),c=(u[1]+"").trim(),s.push({field:d,operator:l,value:c}))}else{for(var g=["<>","<",">","="],f=0;f<g.length;f++)if(e.indexOf(g[f])>=0){a=g[f];break}var u=e.split(a);u.length>1&&(d=(u[0]+"").trim(),c=(u[1]+"").trim(),s.push({field:d,operator:a,value:c}))}n.filters=[];for(var f=0;f<s.length;f++){var p=s[f];n.field=p.field,n.filters.push(p)}}else n.field=e.field,n.filters=e.filter?e.filter.filters:[];if(!KD.isEmpty(n)){var h=n.field.trim().toUpperCase();if(KD.isArray(n.filters)&&!KD.isEmpty(h)){var D=o.getColumnDescriptor.call(o,h);if(D){D.resetFilter();for(var y=0;y<n.filters.length;y++)D.setFilter.call(D,n.filters[y],t)}t&&0!=i&&(o.setUpdateView.call(o,!0),r.setRefreshGridDataFlag(!0))}}}},revertGridServerStates:function(){var e=this,t=e.serverFilterString=e.serverFilterString||[];if(!KD.isEmpty(t))for(var i=0;i<t.length;i++)e.setFilterStringInner(t[i],!0,!1)},fireFilterEvents:function(e){var t=this,i=t.getKey(),r=t.getVGridApi();if(r){for(var o=[],n=t.getFormProxy(),a=0;a<e.value.length;a++){var l=e.value[a];o.push(KD.format("[{0}]='{1}'",e.field,l.value))}var s=KD.isEmpty(o)?[]:r.getCurrentRowIds(),d=KD.stringify({FilterString:o.join(" or "),rows:s.join(",")});n&&n.fireCustomEvents.call(n,i,"FilterChanged",d)}},firefilterRowChangeEvents:function(e){var t=this,i=t.getVGridApi();if(i){var r=t.getKey(),o=i.getFilterRowValues(),n=t.getFormProxy(),a=[];for(var l in o){var s=o[l];KD.isRunInForIn(l,o)&&""!=s&&void 0!==s&&a.push(KD.format("Contains([{0}],'{1}')",l,s))}var d=KD.isEmpty(a)?[]:i.getCurrentRowIds(),c=KD.stringify({FilterString:a.join(" and "),rows:d.join(",")});n&&n.fireCustomEvents.call(n,r,"FilterChanged",c)}},setRowHeight:function(e){var t=this,i=t.getStore(),r=parseInt(e);t.rowHeight=isNaN(r)||26>r?26:r,KD.isEmpty(i)||(i.rowHeight=t.rowHeight),t.setRefreshGridDataFlag(!0)},setColHeaderHeight:function(e){var t=this,i=t.getStore(),r=parseInt(e);r=40>r?40:r,KD.isNaN(r)||(KD.isEmpty(i)||(i.colHeaderHeight=r),t.setRefreshGridDataFlag(!0))},setColHeader:function(e){var t=this,i=t.getStore();if(!KD.isEmpty(e)){var r=KD.getValue(e,"key",null),o=KD.getValue(e,"header",null);if(!KD.isEmpty(r)&&!KD.isEmpty(o)){r=KDVGridUtils.regularFieldName(r);var n=i.getColumnDescriptor.call(i,r);!KD.isEmpty(n)&&KD.isFunction(n.setCaption)&&n.setCaption.call(n,o),t.setRefreshGridDataFlag(!0)}}},onMkButtonClick:function(e,t){if(this.isEnableMkModel()){var i=this.getUIFocusedCellData();i=i||{};var r=this.store;if(r){var o=r.getColumnDescriptor.call(r,i.field);o&&o.onMkButtonClick&&o.onMkButtonClick.call(o,this.key,i.rowId)}}},isEnableMkModel:function(){var e=!1;return KD.isEmpty(this.enableMkModelColumnList)||(e=!0),e},setEnableColumnMkModel:function(e,t){KD.isEmpty(e)||(this.enableMkModelColumnList=this.enableMkModelColumnList||{},t?this.enableMkModelColumnList[e]=t:delete this.enableMkModelColumnList[e])},RefreshCellsData:function(e){var t=this;t.updateFieldStates.call(t,e)}})}(jQuery),function(e){e.extend(KDVGridProxy.prototype,{setAllowColumnFiltering:function(e){var t=this,i=t.getStore();i&&i.setAllowColumnFiltering.call(i,e)},getAllowColumnFiltering:function(){var e=this,t=e.getStore(),i=t?t.allowColumnFiltering.call(t):!0;return i}})}(jQuery),function(e){e.extend(KDVGridProxy.prototype,{setFocusRowIndex:function(t,i){var r=this;if(t=parseInt(t),!(isNaN(t)||0>t)){var o=r.getUIFocusedCellData(),n=void 0===i?!1:i;if(n||o.rowId!=t||1==r.isNeedSynFocusState){var a=e.extend({},o,{rowId:t});r.invokeSelOp("svrCmdSelectedChanged",KD.stringify(t)),a.noSync=!0,a.isSyncSvrEvent=n,r.invokeSelOp("fireRowChanged",a)}}},setFocusCell:function(e,t){},setMoveFirstRowIndex:function(e){this.setFocusRowIndex(e)},setMoveLastRowIndex:function(e){this.setFocusRowIndex(e)},setMoveNextRowIndex:function(e){this.setFocusRowIndex(e)},setMovePreviousRowIndex:function(e){this.setFocusRowIndex(e)}})}(jQuery),function(e){e.extend(KDVGridProxy.prototype,{onRowSelected:function(t){var i=this,r=i.getVGridApi();if(r){var o=!!((t.node||{}).data||{}).isHeaderSelected,n=r.getSelectedNodes(),a=i.getUIFocusedCellData();0==n.length&&(a.rowId=-1),o&&(a=e.extend(a,{rowId:KDStore.C_HeadCheckAllRowId,field:KDStore.C_SelColKey})),i.onChange(a)}},onSelectionChanged:function(e){var t=this,i=t.getVGridApi();if(i){var r=t.getUIFocusedCellData();t.onChange(r)}},onRowDoubleClicked:function(e){var t=this,i=t.getVGridApi();if(i){var r=t.getUIFocusedCellData(),o=r.rowId,n=t.getFormProxy();n&&(n.lockControl.call(n,t),n.fireEvent.call(n,"EntryRowDoubleClick",t.getKey(),t.checkRowId(o)))}},onRowDataChanged:function(e){var t=this,i=t.getVGridApi();if(i)for(var r=(i.getDisplayedRowCount(),t.getStore()),o=r.getDefaulSelRows.call(r),n=(o||"").split(","),a=0;a<n.length;a++){var l=n[a],s=i.getRowNode(l);s&&s.setSelected(!0)}},onBatchChange:function(e){var t=this.getUIFocusedCellData(e);this.onChange(t)},onChange:function(e){var t=this,i=t.getVGridApi();if(i){var r=i.getSelFieldName();KD.equalsIgnoreCase(e.field,r)&&(e.field=KDStore.C_SelColKey),t.fireEntityRowClick(e),t.onCellSelect(e)}},onCellSelect:function(e){var t=this;t.invokeSelOp("fireCellChanged",e)},onMouseOut:function(e){var t=this;t.selTipsEl&&t.selTipsEl.hide()},onMouseOver:function(t){var i=this;i.selTips&&(t.altKey||t.metaKey&&KD.isMacOS()?KD.delayInvoke(function(){var r=e(t.target).closest(".kd-v-grid-row",i.vgrid).hasClass("kd-v-grid-row-selected");if(r){var o=i.getFormProxy(),n=0;o&&o.hostWindowProxy&&o.hostWindowProxy.getOriginalZindex&&(n=o.hostWindowProxy.getOriginalZindex()),n=n>0?n+10:1e3,i.selTipsEl=i.selTipsEl||e('<div class="kd-grid-seltip">').appendTo(e(document.body)),i.selTipsEl.html(i.selTips).css({top:t.pageY,left:t.pageX,position:"absolute",zIndex:n}).show()}else i.onMouseOut(t)},500):i.onMouseOut(t))}})}(jQuery),function(e){e.extend(KDVGridProxy.prototype,{_getSelRows:function(){return this.invokeSelOp("getSelectedRows")||[]},invokeSelOp:function(){var e=this,t=arguments,i=t[0],r=e.selOp,o=void 0;if(r&&t)switch(t.length){case 1:o=r[i].call(r);break;case 2:o=r[i].call(r,arguments[1]);break;case 3:o=r[i].call(r,arguments[1],arguments[2]);break;case 4:o=r[i].call(r,arguments[1],arguments[2],arguments[3]);break;case 5:o=r[i].call(r,arguments[1],arguments[2],arguments[3],arguments[4])}return o},setLastNavigateTD:function(e){e&&(this.lastNavigateTD=e,KD.writeLog("LastNavigateTD ","setLastNavigateTD and obj.rowId = "+e.rowId+"    obj.field= "+e.field,!0))},setLastFocusTD:function(e){if(e){this.lastFocusTD=e;var t=this.getFormProxy();t.setLastFocusGridTD.call(t,this.getKey(),this.lastFocusTD)}},getLastFocusTD:function(){var e=this.getFormProxy(),t=e.getLastFocusGridTD.call(e,this.getKey());return t}})}(jQuery),function(e){e.extend(KDVGridProxy.prototype,{getServicePara:function(t){var i={},r=this.getVGridApi(),o=[],n=[],a=r?r.getViewColumns():[],l=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.columns?l(i.columns):n.push({colKey:i.field,width:parseInt((i.width||"0").toString().replace("px","")),title:i.title})}};l(a);for(var s=0;s<n.length;s++){var d=n[s],c=this.store.getColumnDescriptor(d.colKey)||{};if(!KD.isEmpty(c.config)&&d.width>0&&!KD.IsNullOrWhiteSpace(c.config.header)){var u=KD.cloneObject(c.config);e.extend(u,{header:u.header||"",width:parseInt(d.width),visible:!0}),o.push(u)}}if(i.columns=o,i.Key=this.getKey(),i.TotalRowCount=this.store.length,i[KD.KDPrintConst.DataUrl]=this.dataUrl,i[KD.KDPrintConst.PrintConfig]=t,void 0!=t.PrintPageSetting&&""!=t.PrintPageSetting){var g=KD.parseObject(t.PrintPageSetting),f=["ListHeaderColor","ListSingleColor","ListDoubleColor","ReportTeamColor"];for(var s in f)KD.isRunInForIn(s,f)&&(g[f[s]]=KD.rgbToHex(g[f[s]]));t.PrintPageSetting=KD.stringify(g)}var p={};return p[KD.KDPrintConst.ServicePara]=i,p[KD.KDPrintConst.PageBuilder]=KD.PrintMode.ListPrint,p[KD.KDPrintConst.GridKey]=this.getKey(),p},printPreview:function(e){var t,i=this.getFormProxy();i&&i.printPreview&&(t=this.getServicePara(e),t[KD.KDPrintConst.OperationKey]="Preview",t[KD.KDPrintConst.PageId]=i.getPageId(),i.printPreview.call(i,t))},print:function(e){var t,i=this.getFormProxy();i&&i.print&&(t=this.getServicePara(e),t[KD.KDPrintConst.OperationKey]="PrintAnsy",t[KD.KDPrintConst.PageId]=i.getPageId(),i.print.call(i,t))}})}(jQuery),function(e){e.extend(KDVGridProxy,{C_ListMaxPageCount:KD.isDebug()?2e4:1e4,getDefaulPageRowStage:function(){var e=[5,20,50,100,200,500,1e3,1500];return e},getProxyBySender:function(e){var t=e&&e.sender?e.sender.options||{}:{},i=t.kdPageId,r=t.kdGridKey,o=i?ClientAppProxy.Current.getAliveForm(i):void 0,n=o&&r?o.getControlProxy.call(o,r):void 0;return n}})}(jQuery),function(){window.KDVGridSelOpStrategy=function(){},KDVGridSelOpStrategy.getOpStratege=function(e){var t=e,i=t.config,r=void 0;return"kdgrid"==i.xtype&&e.isViewGrid.call(e)?r=t.isMultiSelectMode.call(t)?new KDViewVGridSelOp:new KDViewVGridSingleSelOp:"kdgrid"==i.xtype?t.isMultiSelectMode.call(t):"kdtreegrid"==i.xtype||"kdbatchfilter"==i.xtype||(r=new KDVGridSelOpStrategy),r&&(r.setOwnerProxy(e),r.loadConfig(i)),r},KDVGridSelOpStrategy.prototype={},function(e){$.extend(e.prototype,{aTitle:"KDVGridSelOpStrategy",ownerProxy:void 0,_isFirstLoad:!1,_defFocusedRowId:-1,_lastFocusedRowId:-1,_focusedRowId:-1,_isCellChanged:!1,_lastFocusedFieldName:"",_focusedFieldName:"",_lastSelectedRowIds:"",_selectedRowIds:"",setOwnerProxy:function(e){this.ownerProxy=e},cellChangedFlag:function(){return this._isCellChanged},beginCellChanged:function(){this._isCellChanged=!0},endCellChanged:function(){this._isCellChanged=!1},loadConfig:function(e){this.config=e},isDefSelected:function(e){return void 0!==e&&(this.config.IsDefaultSelected=e),this.config.IsDefaultSelected},isFireCellFocuedEvent:function(){return 1==KD.getValue(this.config,"FireCellFocuedEvent",0)?!0:!1},isViewGrid:function(){return this.config&&"VIEWGRID"==this.config.gridtype},isMultiSelectMode:function(){var e=!1,t=this,i=t.config,r=void 0===i.IsListMultiSel?!t.isEditable():i.IsListMultiSel;return e=t.isViewGrid()?t.isSelColEnable()&&r:r},isSingleSelectMode:function(){return!this.isMultiSelectMode()},isSelColEnable:function(){return this.config&&!!this.config.enableSelCol||this.isViewGrid()},isFlowViewList:function(){return this.isViewGrid()&&(KDFlowlayoutProxy.isInVertical(this.config)||KDFlowlayoutProxy.isInColumn(this.config))},isFlowEditGrid:function(){return this.isEditable()&&KDFlowlayoutProxy.isFlowlayoutChild(this.config)},isEditable:function(){var e=this.isViewGrid();return e?!e:KD.getValue(this.config,"editable",!0)},isRowSelChanged:function(){return(this._lastFocusedRowId!=this._focusedRowId||this._lastSelectedRowIds!=this._selectedRowIds)&&!this.cellChangedFlag()},isColSelChanged:function(){return this._lastFocusedFieldName!=this._focusedFieldName},isCellChanged:function(){return this.cellChangedFlag()&&(this._lastFocusedRowId!=this._focusedRowId||this._lastSelectedRowIds!=this._selectedRowIds)||this.isColSelChanged()},isLastCell:function(e){return e.rowId==this._lastFocusedRowId&&e.field==this._lastFocusedFieldName},isUserCurrentPara:function(e){return"current"==e},isHeaderCheckAll:function(e){return e&&KDStore.isColSelector(e.field)&&e.rowId==KDStore.C_HeadCheckAllRowId},_setSelectedRowIds:function(e,t){var i=this,r=i.ownerProxy.getStore.call(i.ownerProxy),o=i.__str2arr(t);r.clearSelectedIds.call(r),r.setSelectedIds.call(r,o),i._selectedRowIds=t;var n=parseInt((e+"").split(",")[0]||"-1");i._focusedRowId=isNaN(n)?-1:n},__arr2str:function(e){return KD.stringify(e||[]).replace(/[\[\]\s]/g,"")},__str2arr:function(e,t){e=KD.isString(e)?e.replace(/\s/g,""):"";var i=[],r=""==e?[]:e.split(",");for(var o in r)if(KD.isRunInForIn(o,r)){var n=parseInt(r[o]);isNaN(n)||i.push(n)}if(void 0!==t){var a=parseInt(t);!isNaN(a)&&i.indexOf(a)<0&&i.splice(0,0,a)}return i},getFocusedRowId:function(){var e=KD.isString(this._focusedRowId)?parseInt(this._focusedRowId):this._focusedRowId;return e},getSelectedRowIds:function(){return this._selectedRowIds||""},isSelectedRow:function(e){var t=this.getSelectedRowIdArray();return t.indexOf(e)>=0},getSelectedRowIdArray:function(){return this.__str2arr(this.getSelectedRowIds())},getSelectedRows:function(){var e=this,t=e.ownerProxy;if(!t.rendered)return[];for(var i=(t.getStore.call(t),e.getSelectedRowIds()+""),r=i.split(","),o=0;o<r.length;o++)isNaN(parseInt(r[o]))&&(r.splice(o,1),o--);return r},_checkRowId:function(e){return void 0===e?-1:e},setFirstLoad:function(){this._isFirstLoad=!0},resetFirstLoad:function(){this._isFirstLoad=!1},isFirstLoad:function(){return 1==this._isFirstLoad},isNeedRefreshOwner:function(e){var t=this,i=10,r=3,o=t.ownerProxy.getStore.call(t.ownerProxy),n=o.rows.length>i||(KD.isArray(e)?e.length>r:!1);return n}})}(KDVGridSelOpStrategy),function(e){$.extend(e.prototype,{initConfigSelected:function(e){var t=this;t.reset(),t.isDefSelected(KD.getValue(e,"allowdefaultselected",!0))},initDataSelected:function(e){var t=this;t.setFirstLoad()},svrCmdSelectedChanged:function(e){var t=this,i=t.ownerProxy.getStore.call(t.ownerProxy),r=i.selColDescriptor;if(!t.isUserCurrentPara(e)){var o=t.__str2arr(e),n=e,a=void 0===o[0]?-1:o[0];if(-1==a){var l=i.getFirstRowId.call(i);a=parseInt(l)}t._setSelectedRowIds(a,n)}(t.isDefSelected()||!t.isFirstLoad())&&(t.syncSel2UI(),t.syncColHeadValue()),t.isFirstLoad()&&($.extend(t,{_lastFocusedRowId:-1,_lastFocusedFieldName:"",_lastSelectedRowIds:""}),t.fireRowChanged({rowId:t._focusedRowId,field:t._focusedFieldName}),t.resetFirstLoad(),r&&r.isInit.call(r,!1))},syncColHeadValue:function(){},syncSel2UI:function(){},clearUISelection:function(){var e=this,t=e.ownerProxy,i=(t.getStore.call(t),t.getVGridApi.call(t));return t.isInit=!0,i.clearSelection(),t.isInit=!1,[]},syncUI2Sel:function(e){var t=this,i=e.rowId;if(-1!=i){for(var r=t.ownerProxy.getVGridApi.call(t.ownerProxy),o=r.getSelectedNodes(),n=(o.length,[]),a=0;a<o.length;a++){var l=o[a];isNaN(parseInt(l))||n.push(l)}var s=t.__arr2str(n);return s}},reset:function(){this.resetFirstLoad(),$.extend(this,{_selectedMaps:{},_defFocusedRowId:-1,_lastFocusedRowId:-1,_focusedRowId:-1,_lastFocusedFieldName:"",_focusedFieldName:"",_lastSelectedRowIds:"",_selectedRowIds:""})},fireRowChanged:function(e){var t=this,i=e.rowId,r=e.field,o="";if(t.endCellChanged(),void 0===i)return t._lastSelectedRowIds;if(o=t.isFirstLoad()?t.getSelectedRowIds():e.noSync?i+"":t.syncUI2Sel(e),0>i&&(i=t._lastFocusedRowId),t._setSelectedRowIds(i,o),!t.isRowSelChanged())return t._lastSelectedRowIds;$.extend(t,{_lastSelectedRowIds:o,_selectedRowIds:o,_lastFocusedRowId:t._focusedRowId,_lastFocusedFieldName:r||"",_focusedFieldName:r||""});var n=i,a=t.ownerProxy.getKey.call(t.ownerProxy),l=t.ownerProxy.getFormProxy.call(t.ownerProxy),s={frm:l,onwerKey:a,fieldName:r,cellData:e,svrRowId:n};return KD.delayInvoke(function(e){if(!KD.isEmpty(e)){var i=e.frm,r=e.onwerKey,o=e.fieldName,n=e.cellData,a=e.svrRowId;i&&(i.commitDataBeforeGridRowChanged&&i.commitDataBeforeGridRowChanged.call(i,r,o),KD.getValue(n,"isSyncSvrEvent",!1)?i.fireSyncEvent.call(i,"EntityRowClick",r,t._checkRowId(a)):i.fireEvent.call(i,"EntityRowClick",r,t._checkRowId(a)))}},20,!1,s),t.getSelectedRowIds()},fireCellChanged:function(e){var t=this,i=t.ownerProxy,r=e.rowId,o=e.field;if(t._focusedFieldName=o||"",t.beginCellChanged(),0>r&&(r=t._lastFocusedRowId),t.isFireCellFocuedEvent()&&null!=r&&(e.forceFire||t.isCellChanged()||r!=t._lastFocusedRowId)){var n=t.ownerProxy.getKey.call(t.ownerProxy),a=t.ownerProxy.getFormProxy.call(t.ownerProxy);KD.delayInvoke(function(e){if(a){var l=t._lastFocusedFieldName||"",s=void 0==t._lastFocusedRowId?-1:t._lastFocusedRowId,d=o||i.getFirstVisColName.call(i)||"";a.fireEventNoData.call(a,"EntryCellFocued",n,d,r,s,l,null)}},10)}t._lastFocusedFieldName=o||"",1!=i.isIgnoreClickStatus&&i.setLastFocusTD(e)},afterRowDataChange:function(e){this.fireRowChanged(e),e.forceFire=!0,this.fireCellChanged(e)}})}(KDVGridSelOpStrategy)}(),function(e){window.KDViewVGridSelOp=KD.extend(e,{aTitle:"KDViewVGridSelOp",initConfigSelected:function(e){KDViewVGridSelOp.superclass.initConfigSelected.call(this,e)},initDataSelected:function(e){var t=this,i=t.ownerProxy.getStore.call(t.ownerProxy),r=i?i.selColDescriptor:void 0;r&&r.reset.call(r);var o=e.selRows||"";if(t.isDefSelected()){i.clearSelectedIds.call(i);var n=t.__str2arr(e.selRows,e.focusrowindex);o=t.__arr2str(n),i.setSelectedIds.call(i,n)}else i.clearSelectedIds.call(i);$.extend(t,{_focusedRowId:e.focusrowindex,_focusedFieldName:"",_selectedRowIds:o}),t.setFirstLoad()},isBulkData:function(){var e=this,t=e.ownerProxy,i=t.getStore.call(t),r=i.isBulkData.call(i);return r},scrollToSelectRow:function(){},isSameRow:function(e){return e=e||{},this._focusedRowId==e.rowId},svrCmdSelectedChanged:function(e){var t=this,i=t.ownerProxy.getStore.call(t.ownerProxy),r=i.selColDescriptor;if(t.isUserCurrentPara(e)){var o=this.getSelectedRowIdArray(),n=0==o.length?[]:i.existRowIds.call(i,o);if(0==n.length){var a=i.getFirstRowId.call(i),l=parseInt(a);n.push(l)}n.length!=o.length&&(d=void 0===n[0]?-1:n[0],t._setSelectedRowIds(d,t.__arr2str(n)))}else{var n=t.__str2arr(e),s=e,d=void 0===n[0]?-1:n[0];t._setSelectedRowIds(d,s)}(t.isDefSelected()||!t.isFirstLoad())&&(t.syncSel2UI(),t.syncColHeadValue()),t.isFirstLoad()&&($.extend(t,{_lastFocusedRowId:-1,_lastFocusedFieldName:"",_lastSelectedRowIds:""}),t.fireRowChanged({rowId:t._focusedRowId,field:t._focusedFieldName}),t.resetFirstLoad(),r&&r.isInit.call(r,!1))},syncColHeadValue:function(){},syncSel2UI:function(){var e=this,t=e.ownerProxy,i=t.getVGridApi.call(t),r=e.getSelectedRowIdArray();i&&KD.isArray(r)&&!KD.isEmpty(r)&&(e.clearUISelection(),i&&i.setCurrentRowIds(r,!0))},clearUISelection:function(){var e=this,t=e.ownerProxy,i=t.getVGridApi.call(t);i&&i.clearSelection()},syncUI2Sel:function(e){var t=KDViewVGridSelOp.superclass.syncUI2Sel.call(this,e);return t},handleSelect:function(e){},syncUI2SelBulk:function(e){},reset:function(){var e=this,t=e.ownerProxy.getStore.call(e.ownerProxy),i=t?t.selColDescriptor:void 0;i&&i.reset.call(i),e.resetFirstLoad(),$.extend(e,{_defFocusedRowId:-1,_lastFocusedRowId:-1,_focusedRowId:-1,_lastFocusedFieldName:"",_focusedFieldName:"",_lastSelectedRowIds:"",_selectedRowIds:""})},fireRowChanged:function(e){var t=this,i=e.rowId,r=e.field,o="",n=t.isHeaderCheckAll(e);if(t.endCellChanged(),void 0===i)return t._lastSelectedRowIds;if(e.noSync)o=i+"";else if(n){var a=t.ownerProxy,l=a.getSelectedIds.call(a);o=t.__arr2str(l)}else o=t.syncUI2Sel(e)||"";if(0>i&&(i=t._lastFocusedRowId),""==o&&!n&&e.isSel&&(o=""+i),t._setSelectedRowIds(i,o),!t.isRowSelChanged())return t._lastSelectedRowIds;$.extend(t,{_lastSelectedRowIds:o,_selectedRowIds:o,_lastFocusedRowId:t._focusedRowId,_lastFocusedFieldName:r||"",_focusedFieldName:r||""});var s=i;if(!(0>s)){var d=t.ownerProxy.getKey.call(t.ownerProxy),c=t.ownerProxy.getFormProxy.call(t.ownerProxy);return c&&(c.commitDataBeforeGridRowChanged&&c.commitDataBeforeGridRowChanged.call(c,d,r),KD.getValue(e,"isSyncSvrEvent",!1)?c.fireSyncEvent.call(c,"EntityRowClick",d,t._checkRowId(s)):c.fireEvent.call(c,"EntityRowClick",d,t._checkRowId(s))),t.getSelectedRowIds()}},fireCellChanged:function(e){KDViewVGridSelOp.superclass.fireCellChanged.call(this,e)},afterRowDataChange:function(e){KDViewVGridSelOp.superclass.afterRowDataChange.call(this,e)}})}(KDVGridSelOpStrategy),function(e){window.KDViewVGridSingleSelOp=KD.extend(KDViewVGridSelOp,{aTitle:"KDViewVGridSingleSelOp",isRowSelChanged:function(){return this._lastFocusedRowId!=this._focusedRowId&&!this.cellChangedFlag()},initConfigSelected:function(e){KDViewVGridSingleSelOp.superclass.initConfigSelected.call(this,e)},initDataSelected:function(e){KDViewVGridSingleSelOp.superclass.initDataSelected.call(this,e)},syncSel2UI:function(){KDViewVGridSingleSelOp.superclass.syncSel2UI.call(this)},syncUI2Sel:function(e){var t=KDViewVGridSingleSelOp.superclass.syncUI2Sel.call(this,e);return t},fireRowChanged:function(e){var t=this,i=e.rowId,r=e.field,o="",n=t.isHeaderCheckAll(e);if(t.endCellChanged(),void 0===i)return t._lastSelectedRowIds;if(o=t.isFirstLoad()?t.getSelectedRowIds():e.noSync?i+"":t.syncUI2Sel(e),0>i&&(i=t._lastFocusedRowId),t._setSelectedRowIds(i,o),!n&&!t.isRowSelChanged())return t._lastSelectedRowIds;$.extend(t,{_lastSelectedRowIds:o,_selectedRowIds:o,_lastFocusedRowId:t._focusedRowId,_lastFocusedFieldName:r||"",_focusedFieldName:r||""});var a=i,l=t.ownerProxy.getKey.call(t.ownerProxy),s=t.ownerProxy.getFormProxy.call(t.ownerProxy);return s&&(KD.getValue(e,"isSyncSvrEvent",!1)?s.fireSyncEvent.call(s,"EntityRowClick",l,t._checkRowId(a)):s.fireEvent.call(s,"EntityRowClick",l,t._checkRowId(a))),t.getSelectedRowIds()}})}(KDVGridSelOpStrategy);
//# sourceMappingURL=kdvgrid.galaxy.biz.min.js.map